<schaeffler-banner></schaeffler-banner>
<div class="sidenav-content-container">
  <div fxFlex="1 0 calc(100% - 40px)">
    <mat-card class="ltp-prediction-card" fxLayout="column" fxFlexFill>
      <mac-breadcrumbs
        [breadcrumbs]="breadcrumbs$ | ngrxPush"
      ></mac-breadcrumbs>
      <mat-card-title>{{ 'ltp.home.headline' | transloco }}</mat-card-title>
      <div fxFlex>
        <mat-card-content
          class="ltp-prediction-container"
          fxLayout="column"
          fxFlexFill
        >
          <div
            class="ltp-prediction-border-bottom"
            fxLayout="row"
            fxLayoutAlign="space-between stretch"
            *transloco="let t; read: 'ltp.prediction'"
          >
            <div fxLayout="row" fxLayoutAlign="start stretch">
              <mat-tab-group
                mat-align-tabs="center"
                (selectedTabChange)="selectChartType($event.index)"
              >
                <mat-tab>
                  <ng-template mat-tab-label>
                    <h4>{{ t('woehler') }}</h4>
                  </ng-template>
                </mat-tab>
                <mat-tab>
                  <ng-template mat-tab-label>
                    <h4>{{ t('haigh') }}</h4>
                  </ng-template>
                </mat-tab>
              </mat-tab-group>
            </div>
            <div fxLayout="row" fxLayoutAlign="end stretch">
              <button mat-button [matMenuTriggerFor]="uploadMenu">
                <span
                  fxLayout="row"
                  fxLayoutAlign="space-between center"
                  fxLayoutGap="5px"
                >
                  <mat-icon
                    fontSet="schaeffler-icons"
                    fontIcon="icon-upload"
                  ></mat-icon>
                  <span fxHide.lt-sm>{{ t('upload') }}</span>
                  <mat-icon
                    fontSet="schaeffler-icons"
                    fontIcon="icon-arrow-down"
                  ></mat-icon>
                </span>
              </button>
              <mat-menu #uploadMenu="matMenu">
                <button
                  mat-menu-item
                  (click)="fileInput.click()"
                  disabled="false"
                >
                  <span>{{ t('csv') }}</span>
                  <input
                    hidden
                    #fileInput
                    type="file"
                    id="file"
                    accept=".csv, text/plain"
                    (change)="
                      handleFileInput($event.target.files); fileInput.value = ''
                    "
                  />
                </button>
                <button
                  mat-menu-item
                  (click)="handleDummyLoad()"
                  disabled="false"
                >
                  <span translate>{{ t('csv_dummy') }}</span>
                </button>
              </mat-menu>
              <button mat-button [matMenuTriggerFor]="exportMenu">
                <span
                  fxLayout="row"
                  fxLayoutAlign="space-between center"
                  fxLayoutGap="5px"
                >
                  <mat-icon
                    fontSet="schaeffler-icons"
                    fontIcon="icon-export"
                  ></mat-icon>
                  <span fxHide.lt-sm>{{ t('export') }}</span>
                  <mat-icon
                    fontSet="schaeffler-icons"
                    fontIcon="icon-arrow-down"
                  ></mat-icon>
                </span>
              </button>
              <mat-menu #exportMenu="matMenu">
                <a
                  [href]="chart.imgUrl"
                  [download]="chart.filename"
                  (click)="chart.exportChart()"
                  class="download-button"
                >
                  <button mat-menu-item>
                    <!-- <button mat-menu-item (click)="chart.exportChart()"> -->
                    <span>{{ t('png') }}</span>
                  </button>
                </a>
              </mat-menu>
            </div>
          </div>
          <div
            class="ltp-prediction-container-bottom"
            fxLayout="row"
            fxLayout.lt-lg="column"
            fxLayoutAlign="space-between stretch"
            fxLayoutGap.gt-md="20px"
            fxFlex
          >
            <div fxFlex="50%" fxLayout.gt-md="column" fxFlex.gt-md="70%">
              <mac-ltp-chart
                #chart
                [chartSettings]="chartOptions"
                [mergeData$]="mergeData$"
                class="full-height"
              ></mac-ltp-chart>
            </div>
            <div fxLayout="column" fxFlex="50%" fxFlex.gt-md="30%">
              <div
                class="ltp-prediction-padding-bottom"
                fxLayout="column"
                fxLayoutAlign="space-around stretch"
                fxLayoutGap="20px"
                *transloco="let t; read: 'ltp.prediction.chart'"
              >
                <mat-accordion displayMode="flat" fxHide.gt-md>
                  <ng-container>
                    <mat-expansion-panel class="mat-elevation-z0">
                      <mat-expansion-panel-header>
                        <div
                          fxLayout="row"
                          fxLayoutAlign="space-between center"
                        >
                          <mat-panel-title>
                            <span class="ltp-prediction-legend-header">{{
                              t('legend')
                            }}</span>
                          </mat-panel-title>
                          <mat-panel-description>
                            <mac-tooltip
                              (click)="$event.stopPropagation()"
                              [content]="t('legendDescription')"
                              manualcolor="#1d9bb2"
                              icon="icon-toast-information"
                            ></mac-tooltip>
                          </mat-panel-description>
                        </div>
                      </mat-expansion-panel-header>
                      <ng-container>
                        <mac-ltp-legend
                          [graphs]="legendGraphs"
                        ></mac-ltp-legend>
                      </ng-container>
                    </mat-expansion-panel>
                  </ng-container>
                </mat-accordion>

                <div
                  fxLayout="column"
                  fxLayoutAlign="space-around stretch"
                  fxLayoutGap="10px"
                  fxHide.lt-lg
                >
                  <div fxLayout="row" fxLayoutAlign="space-between center">
                    <span class="ltp-prediction-legend-header">{{
                      t('legend')
                    }}</span>
                    <mac-tooltip
                      (click)="$event.stopPropagation()"
                      [content]="t('legendDescription')"
                      manualcolor="#1d9bb2"
                      icon="icon-toast-information"
                    ></mac-tooltip>
                  </div>
                  <mac-ltp-legend [graphs]="legendGraphs"></mac-ltp-legend>
                  <mat-divider></mat-divider>
                </div>
              </div>
              <div
                fxLayout="column"
                fxFlex
                fxLayoutAlign="end center"
                fxLayoutAlign.lt-lg="space-around stretch"
                fxLayoutAlign.lt-sm="space-around center"
                *transloco="let t; read: 'ltp.prediction.kpi'"
              >
                <h4 class="ltp-prediction-kpi-headline">
                  {{ t('headline') }}
                </h4>
                <mac-ltp-kpi
                  *ngIf="showWoehler()"
                  [value]="
                    (predictionResult | ngrxPush).kpi?.fatigue.toFixed(0)
                  "
                  description="prediction.kpi.fatigue"
                ></mac-ltp-kpi>
                <mac-ltp-kpi
                  *ngIf="showWoehler()"
                  [value]="
                    (predictionResult | ngrxPush).kpi?.slope?.toFixed(2) ||
                    t('rrelNA')
                  "
                  description="prediction.kpi.slope"
                  [tooltip]="
                    !(predictionResult | ngrxPush).kpi?.slope
                      ? 'rrelNAInfo'
                      : undefined
                  "
                ></mac-ltp-kpi>
                <mac-ltp-kpi
                  *ngIf="showWoehler()"
                  [value]="
                    !(predictionResult | ngrxPush).kpi?.slope
                      ? t('countNA')
                      : (predictionResult | ngrxPush).kpi?.count === -1
                      ? '∞'
                      : (predictionResult | ngrxPush).kpi?.count
                  "
                  [description]="
                    (predictionResult | ngrxPush).kpi?.count === -1
                      ? 'prediction.kpi.survivor'
                      : 'prediction.kpi.count'
                  "
                  [descriptionParams]="{
                    mpa: (predictionResult | ngrxPush)?.kpi?.mpa || ''
                  }"
                  [tooltip]="
                    !(predictionResult | ngrxPush).kpi?.slope
                      ? 'countNAInfo'
                      : undefined
                  "
                ></mac-ltp-kpi>

                <mac-ltp-kpi
                  *ngIf="!showWoehler()"
                  [value]="
                    (predictionResult | ngrxPush).kpi?.fatigue.toFixed(0)
                  "
                  description="prediction.kpi.fatigue0"
                ></mac-ltp-kpi>
                <mac-ltp-kpi
                  *ngIf="!showWoehler()"
                  [value]="
                    (predictionResult | ngrxPush).kpi?.fatigue1.toFixed(0)
                  "
                  description="prediction.kpi.fatigue1"
                ></mac-ltp-kpi>
                <mac-ltp-kpi
                  *ngIf="!showWoehler()"
                  [value]="
                    (predictionResult | ngrxPush).kpi?.meanStress.toFixed(2)
                  "
                  description="prediction.kpi.meanStress"
                ></mac-ltp-kpi>
              </div>
            </div>
          </div>
        </mat-card-content>
      </div>
    </mat-card>
  </div>
</div>
