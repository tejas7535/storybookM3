<!-- eslint-disable @angular-eslint/template/cyclomatic-complexity -->
<ng-container
  *transloco="let t; read: 'materialsSupplierDatabase.mainTable.dialog'"
>
  <div mat-dialog-title class="!-mx-6 !-mt-4">
    <div class="flex flex-row content-around justify-between pl-4 pb-2 pr-2">
      <div class="my-auto text-h6 text-high-emphasis">
        {{
          dialogData.editDialogInformation || materialId
            ? t('updateTitle')
            : t('addTitle')
        }}
      </div>
      <div class="flex flex-row">
        <button mat-icon-button (click)="minimizeDialog()">
          <mat-icon class="text-medium-emphasis">minimize</mat-icon>
        </button>
        <button mat-icon-button (click)="cancelDialog()">
          <mat-icon class="text-medium-emphasis">close</mat-icon>
        </button>
      </div>
    </div>
    <mat-divider></mat-divider>
  </div>

  <mat-dialog-content class="!px-4">
    <div
      *ngIf="
        !(dialogLoading$ | ngrxPush) && !(editLoading$ | ngrxPush);
        else dialogLoadingTemplate
      "
    >
      <div class="flex flex-col gap-y-3">
        <div class="text-subtitle-2 text-high-emphasis">
          {{ t('materialStandardTitle') }}
        </div>
        <div
          class="flex flex-row gap-x-6"
          *ngIf="!hasReadonlyOptions(); else matStdReadonly"
        >
          <schaeffler-select
            appearance="outline"
            class="w-full"
            [stringOptions]="standardDocuments$ | ngrxPush"
            [control]="standardDocumentsControl"
            [label]="t('standardDocument')"
            [filterFn]="standardDocumentFilterFnFactory(materialNamesControl)"
            [resetButton]="true"
            addEntry="true"
            (entryAdded)="addStandardDocument($event)"
            name="materialStandardStandardDocument"
            #dialogControl
          >
            <div matErrorContent *ngIf="standardDocumentsControl.invalid">
              {{ getErrorMessage(standardDocumentsControl.errors) }}
            </div>
          </schaeffler-select>
          <schaeffler-select
            appearance="outline"
            class="w-full"
            [stringOptions]="materialNames$ | ngrxPush"
            [control]="materialNamesControl"
            [label]="t('materialName')"
            [filterFn]="materialNameFilterFnFactory(standardDocumentsControl)"
            addEntry="true"
            (entryAdded)="addMaterialName($event)"
            name="materialStandardMaterialName"
            #dialogControl
          >
            <div matErrorContent *ngIf="materialNamesControl.invalid">
              {{ getErrorMessage(materialNamesControl.errors) }}
            </div>
          </schaeffler-select>
        </div>
        <ng-template #matStdReadonly>
          <div class="flex flex-row gap-x-6">
            <mat-form-field appearance="outline" class="w-full">
              <mat-label
                >{{ t('standardDocument') }} {{ t('readonly') }}</mat-label
              >
              <input
                matInput
                [value]="standardDocumentsControl.value.title"
                name="materialStandardStandardDocument"
                #dialogControl
                readonly="true"
              />
            </mat-form-field>
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>{{ t('materialName') }} {{ t('readonly') }}</mat-label>
              <input
                matInput
                [value]="materialNamesControl.value.title"
                name="materialStandardMaterialName"
                #dialogControl
                readonly="true"
              />
            </mat-form-field>
          </div>
        </ng-template>
        <div class="flex flex-row gap-x-6">
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>{{ t('steelNumber') }}</mat-label>
            <input
              matInput
              placeholder="1.1234"
              value=""
              [formControl]="steelNumberControl"
              name="materialNumbers"
              #dialogControl
            />
            <mat-error
              *ngIf="steelNumberControl.invalid"
              [matTooltip]="t('error.steelNumber')"
              class="cursor-help"
            >
              {{ getErrorMessage(steelNumberControl.errors) }}
              <mat-icon inline="true" class="!leading-3">info_outline</mat-icon>
            </mat-error>
          </mat-form-field>
          <div class="flex w-full flex-row">
            <schaeffler-select
              appearance="outline"
              class="w-full"
              [filterFn]="filterFn"
              [label]="t('referencedInDocument')"
              [stringOptions]="referenceDocuments$ | ngrxPush"
              [control]="referenceDocumentControl"
              [loading]="referenceDocumentsLoading$ | ngrxPush"
              [addEntry]="true"
              [multiple]="true"
              (entryAdded)="addReferenceDocument($event)"
              name="referenceDoc"
              #dialogControl
            ></schaeffler-select>
            <span mat-icon class="mb-4 self-center pl-4">
              <mat-icon
                [matTooltip]="t('tooltip.referencedInDocument')"
                matTooltipPosition="before"
                class="cursor-help text-link"
                >info_outline</mat-icon
              >
            </span>
          </div>
        </div>

        <div class="text-subtitle-2 text-high-emphasis">
          {{ t('supplierInformationTitle') }}
        </div>
        <div
          class="flex flex-row gap-x-6"
          *ngIf="!hasReadonlyOptions(); else supplierReadonly"
        >
          <schaeffler-select
            appearance="outline"
            class="w-full"
            [stringOptions]="suppliers$ | ngrxPush"
            [control]="suppliersControl"
            [filterFn]="filterFn"
            [label]="t('supplierName')"
            [addEntry]="true"
            (entryAdded)="addSupplierName($event)"
            name="manufacturerSupplierName"
            #dialogControl
          >
            <div matErrorContent *ngIf="suppliersControl.invalid">
              {{ getErrorMessage(suppliersControl.errors) }}
            </div>
          </schaeffler-select>
          <schaeffler-select
            appearance="outline"
            class="w-full"
            [stringOptions]="supplierPlants$ | ngrxPush"
            [control]="supplierPlantsControl"
            [filterFn]="
              valueTitleToOptionKeyFilterFnFactory(
                suppliersControl,
                'supplierName'
              )
            "
            [label]="t('supplierPlant')"
            [addEntry]="true"
            (entryAdded)="addSupplierPlant($event)"
            name="manufacturerSupplierPlant"
            #dialogControl
          >
            <div matErrorContent *ngIf="supplierPlantsControl.invalid">
              {{ getErrorMessage(supplierPlantsControl.errors) }}
            </div>
          </schaeffler-select>

          <schaeffler-select
            appearance="outline"
            class="w-full"
            [stringOptions]="supplierCountries$ | ngrxPush"
            [control]="supplierCountriesControl"
            [label]="t('supplierCountry')"
            [addEntry]="true"
            [filterFn]="filterFn"
            (entryAdded)="addSupplierCountry($event)"
            name="manufacturerSupplierCountry"
            #dialogControl
          >
            <div matErrorContent *ngIf="supplierCountriesControl.invalid">
              {{ getErrorMessage(supplierCountriesControl.errors) }}
            </div>
          </schaeffler-select>
        </div>
        <ng-template #supplierReadonly>
          <div class="flex flex-row gap-x-6">
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>{{ t('supplierName') }} {{ t('readonly') }}</mat-label>
              <input
                matInput
                [value]="suppliersControl.value.title"
                name="manufacturerSupplierName"
                #dialogControl
                readonly="true"
              />
            </mat-form-field>
            <mat-form-field appearance="outline" class="w-full">
              <mat-label
                >{{ t('supplierPlant') }} {{ t('readonly') }}</mat-label
              >
              <input
                matInput
                [value]="supplierPlantsControl.value.title"
                name="manufacturerSupplierPlant"
                #dialogControl
                readonly="true"
              />
            </mat-form-field>
            <mat-form-field appearance="outline" class="w-full">
              <mat-label
                >{{ t('supplierCountry') }} {{ t('readonly') }}</mat-label
              >
              <input
                matInput
                [value]="supplierCountriesControl.value.title"
                name="manufacturerSupplierCountry"
                #dialogControl
                readonly="true"
              />
            </mat-form-field>
          </div>
        </ng-template>
        <div class="flex flex-row gap-x-6">
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>{{ t('castingMode') }}</mat-label>
            <mat-select
              [formControl]="castingModesControl"
              name="castingMode"
              #dialogControl
            >
              <mat-option
                *ngFor="let mode of castingModes$ | ngrxPush"
                [value]="mode"
              >
                {{ t(mode.toLowerCase()) }}
              </mat-option>
            </mat-select>

            <mat-error *ngIf="castingModesControl.invalid">{{
              getErrorMessage(castingModesControl.errors)
            }}</mat-error>
          </mat-form-field>
          <schaeffler-select
            appearance="outline"
            class="w-full"
            [stringOptions]="castingDiameters$ | ngrxPush"
            [control]="castingDiameterControl"
            [filterFn]="filterFn"
            [addEntry]="true"
            [label]="t('castingDiameter')"
            (entryAdded)="addCastingDiameter($event)"
            [resetButton]="false"
            [loading]="castingDiametersLoading$ | ngrxPush"
            name="castingDiameter"
            #dialogControl
          >
            <div matErrorContent *ngIf="castingDiameterControl.invalid">
              {{ getErrorMessage(castingDiameterControl.errors) }}
            </div>
          </schaeffler-select>
        </div>
        <div class="flex flex-row gap-x-6">
          <mat-form-field appearance="outline" class="w-auto">
            <mat-label>{{ t('supplierRating') }}</mat-label>
            <mat-select
              [formControl]="ratingsControl"
              [compareWith]="compareWithId"
              name="rating"
              #dialogControl
            >
              <mat-option
                *ngFor="let rating of ratings$ | ngrxPush"
                [value]="rating"
              >
                {{ rating.title }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="ratingsControl.invalid">{{
              getErrorMessage(ratingsControl.errors)
            }}</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>{{ t('supplierRatingRemark') }}</mat-label>
            <input
              matInput
              [formControl]="ratingRemarkControl"
              name="ratingRemark"
              #dialogControl
            />
          </mat-form-field>
        </div>

        <div class="flex flex-row gap-x-6">
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>{{ t('ratingChangeComment') }}</mat-label>
            <textarea
              matInput
              [formControl]="ratingChangeCommentControl"
              required
              name="ratingChangeComment"
              #dialogControl
            ></textarea>
          </mat-form-field>
        </div>

        <div class="mb-4 flex flex-row gap-x-6">
          <mat-checkbox
            class="text-caption text-high-emphasis"
            color="primary"
            [formControl]="selfCertifiedControl"
            name="manufacturerSupplierSelfCertified"
            #dialogControl
          >
            {{ t('selfCertified') }}
            <mat-icon
              [matTooltip]="t('selfCertified_tooltip')"
              matTooltipPosition="after"
              class="cursor-help !leading-3 text-link"
              inline="true"
              >info_outline</mat-icon
            >
          </mat-checkbox>
        </div>

        <div class="mb-4 flex flex-row gap-x-6">
          <mat-checkbox
            class="text-caption text-high-emphasis"
            color="primary"
            [formControl]="manufacturerControl"
            name="manufacturer"
            #dialogControl
          >
            {{ t('manufacturer') }}
          </mat-checkbox>
        </div>

        <div class="text-subtitle-2 text-high-emphasis">
          {{ t('co2AndProductInformationTitle') }}
        </div>
        <div class="flex flex-row gap-x-6">
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>{{ t('maxDim') }}</mat-label>
            <input
              matInput
              [formControl]="maxDimControl"
              type="number"
              name="maxDimension"
              #dialogControl
            />
            <span matSuffix class="relative -top-1 pl-1 text-caption">{{
              t('mm')
            }}</span>
            <mat-error *ngIf="maxDimControl.invalid">{{
              getErrorMessage(maxDimControl.errors)
            }}</mat-error>
          </mat-form-field>
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>{{ t('minDim') }}</mat-label>
            <input
              matInput
              [formControl]="minDimControl"
              type="number"
              name="minDimension"
              #dialogControl
            />
            <span matSuffix class="relative -top-1 pl-1 text-caption">{{
              t('mm')
            }}</span>
            <mat-error *ngIf="minDimControl.invalid">{{
              getErrorMessage(minDimControl.errors)
            }}</mat-error>
          </mat-form-field>
          <schaeffler-select
            appearance="outline"
            class="w-full"
            [stringOptions]="categories$ | ngrxPush"
            [control]="categoriesControl"
            [filterFn]="filterFn"
            [label]="t('productCategory')"
            [resetButton]="false"
            name="productCategoryText"
            #dialogControl
          >
            <div matErrorContent *ngIf="categoriesControl.invalid">
              {{ getErrorMessage(categoriesControl.errors) }}
            </div>
          </schaeffler-select>
        </div>

        <!-- gap-x-6 did not work out with 4 input fields so i used pr-6 3 times.-->
        <div class="flex flex-row">
          <mat-form-field appearance="outline" class="w-1/4 pr-6">
            <mat-label>{{ t('scope1') }}</mat-label>
            <input
              matInput
              [formControl]="co2Scope1Control"
              type="number"
              name="co2Scope1"
              #dialogControl
            />
            <span matSuffix class="relative -top-1 pl-1 text-caption">{{
              t('co2PerTon')
            }}</span>
            <mat-error *ngIf="co2Scope1Control.invalid">{{
              getErrorMessage(co2Scope1Control.errors)
            }}</mat-error>
          </mat-form-field>
          <mat-form-field appearance="outline" class="w-1/4 pr-6">
            <mat-label>{{ t('scope2') }}</mat-label>
            <input
              matInput
              [formControl]="co2Scope2Control"
              type="number"
              name="co2Scope2"
              #dialogControl
            />
            <span matSuffix class="relative -top-1 pl-1 text-caption">{{
              t('co2PerTon')
            }}</span>
            <mat-error *ngIf="co2Scope2Control.invalid">{{
              getErrorMessage(co2Scope2Control.errors)
            }}</mat-error>
          </mat-form-field>
          <mat-form-field appearance="outline" class="w-1/4 pr-6">
            <mat-label>{{ t('scope3') }}</mat-label>
            <input
              matInput
              [formControl]="co2Scope3Control"
              type="number"
              name="co2Scope3"
              #dialogControl
            />
            <span matSuffix class="relative -top-1 pl-1 text-caption">{{
              t('co2PerTon')
            }}</span>
            <mat-error *ngIf="co2Scope3Control.invalid">{{
              getErrorMessage(co2Scope3Control.errors)
            }}</mat-error>
          </mat-form-field>
          <mat-form-field appearance="outline" class="w-1/4">
            <mat-label>{{ t('co2Total') }}</mat-label>
            <input
              matInput
              [formControl]="co2TotalControl"
              type="number"
              name="co2PerTon"
              #dialogControl
            />
            <span matSuffix class="relative -top-1 pl-1 text-caption">{{
              t('co2PerTon')
            }}</span>
            <mat-error
              class="cursor-help"
              *ngIf="co2TotalControl.invalid"
              [matTooltip]="
                co2TotalControl.errors?.scopeTotalLowerThanSingleScopes
                  ? t('error.co2TooLow')
                  : ''
              "
            >
              {{ getErrorMessage(co2TotalControl.errors) }}
              <mat-icon inline="true" class="!leading-3">info_outline</mat-icon>
            </mat-error>
          </mat-form-field>
        </div>

        <div class="flex flex-row gap-x-6">
          <schaeffler-select
            appearance="outline"
            class="w-auto"
            [stringOptions]="steelMakingProcess$ | ngrxPush"
            [control]="steelMakingProcessControl"
            [filterFn]="steelMakingProcessFilterFn"
            [label]="t('steelMakingProcess')"
            name="steelMakingProcess"
            #dialogControl
            #steelMakingProcessSelect
          ></schaeffler-select>
          <div class="flex w-full flex-row">
            <schaeffler-select
              appearance="outline"
              class="w-full"
              [stringOptions]="co2Classification$ | ngrxPush"
              [control]="co2ClassificationControl"
              [filterFn]="filterFn"
              [label]="t('co2Classification')"
              [resetButton]="false"
              name="co2Classification"
              #dialogControl
            >
              <div matErrorContent *ngIf="co2ClassificationControl.invalid">
                {{ getErrorMessage(co2ClassificationControl.errors) }}
              </div>
            </schaeffler-select>
            <span mat-icon class="mb-4 self-center pl-4">
              <mat-icon
                matTooltipPosition="before"
                [matTooltip]="t('tooltip.co2Classification')"
                class="cursor-help text-link"
                >info_outline</mat-icon
              >
            </span>
          </div>
        </div>

        <div
          class="flex flex-row gap-x-6"
          *ngIf="!hasReadonlyOptions(); else releaseDateReadonly"
        >
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>{{ t('releaseDateYear') }}</mat-label>
            <mat-select
              [formControl]="releaseYearControl"
              name="releaseDate"
              #dialogControl
            >
              <mat-option *ngFor="let year of years" [value]="year">
                {{ year }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="releaseYearControl.invalid">{{
              t('error.required')
            }}</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>{{ t('releaseDateMonth') }}</mat-label>
            <mat-select
              [formControl]="releaseMonthControl"
              name="releaseDateMonth"
              #dialogControl
            >
              <mat-option *ngFor="let month of months" [value]="month">
                {{ t('month.' + month) }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="releaseMonthControl.invalid">{{
              t('error.required')
            }}</mat-error>
          </mat-form-field>
        </div>
        <ng-template #releaseDateReadonly>
          <div class="flex flex-row gap-x-6">
            <mat-form-field appearance="outline" class="w-full">
              <mat-label
                >{{ t('releaseDateYear') }} {{ t('readonly') }}</mat-label
              >
              <input
                matInput
                [value]="releaseDateYearFormatter(releaseYearControl.value)"
                name="releaseDate"
                #dialogControl
                readonly="true"
              />
            </mat-form-field>
            <mat-form-field appearance="outline" class="w-full">
              <mat-label
                >{{ t('releaseDateMonth') }} {{ t('readonly') }}</mat-label
              >
              <input
                matInput
                [value]="releaseDateMonthFormatter(releaseMonthControl.value)"
                name="releaseDateMonth"
                #dialogControl
                readonly="true"
              />
            </mat-form-field>
          </div>
        </ng-template>
        <div class="flex flex-row gap-x-6">
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>{{ t('releaseRestrictions') }}</mat-label>
            <textarea
              matInput
              [formControl]="releaseRestrictionsControl"
              name="releaseRestrictions"
              #dialogControl
            ></textarea>
          </mat-form-field>
        </div>

        <div class="flex flex-row gap-x-6">
          <mat-checkbox
            class="text-caption text-high-emphasis"
            color="primary"
            [formControl]="isBlockedControl"
            name="blocked"
            #dialogControl
          >
            {{ t('blocked') }}
            <mat-icon
              [matTooltip]="t('tooltip.blocked')"
              matTooltipPosition="after"
              class="cursor-help !leading-3 text-link"
              inline="true"
              >info_outline</mat-icon
            >
          </mat-checkbox>
        </div>
      </div>
    </div>
    <ng-template #dialogLoadingTemplate>
      <div class="flex flex-1 flex-col place-items-center">
        <mat-spinner></mat-spinner>
      </div>
    </ng-template>
  </mat-dialog-content>

  <mat-dialog-actions align="end" class="-mx-6">
    <mat-divider class="w-full pb-4"></mat-divider>
    <div class="px-4 pb-2">
      <button mat-stroked-button (click)="cancelDialog()" color="primary">
        {{ t('cancel') }}
      </button>
      <button
        mat-raised-button
        color="primary"
        class="!ml-4"
        [disabled]="!createMaterialForm.valid"
        (click)="confirmMaterial()"
      >
        <div class="flex flex-row gap-x-2">
          {{
            dialogData.editDialogInformation || materialId
              ? t('updateMaterial')
              : t('addMaterial')
          }}
          <mat-spinner
            *ngIf="createMaterialLoading | ngrxPush"
            class="my-auto"
            diameter="14"
          ></mat-spinner>
        </div>
      </button>
    </div>
  </mat-dialog-actions>
</ng-container>
