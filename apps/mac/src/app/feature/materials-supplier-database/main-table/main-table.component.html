<div
  class="flex h-full w-full flex-col md:flex-row"
  *transloco="let t; read: 'materialsSupplierDatabase'"
>
  <div class="border-r border-border">
    <mac-msd-navigation
      [expandMaterialClass]="expandedClass"
      class="h-full w-full"
    ></mac-msd-navigation>
  </div>
  <div
    class="flex w-full flex-1 flex-col md:p-4 md:pb-0 md:pr-0"
    *ngrxLet="navigation$ as navigation"
  >
    <ng-container>
      <mac-quick-filter></mac-quick-filter>

      <div class="flex w-full flex-1" *ngIf="result$ | ngrxPush">
        <div class="h-full w-full">
          <ag-grid-angular
            class="ag-theme-material h-full border border-border"
            [masterDetail]="true"
            [detailCellRenderer]="detailCellRenderer"
            [detailRowAutoHeight]="true"
            [suppressCellFocus]="true"
            [columnDefs]="columnDefs"
            [defaultColDef]="defaultColDef"
            [sideBar]="sidebar"
            [enableCellTextSelection]="true"
            [rowData]="result$ | ngrxPush"
            [tooltipShowDelay]="agGridTooltipDelay"
            (gridReady)="onGridReady($event)"
            (filterChanged)="onFilterChange($event)"
            (firstDataRendered)="setAgGridFilter($event)"
            [rowClass]="['!border-l-0', '!border-t-0']"
            [rowClassRules]="{
              '!bg-opacity-5 !bg-error': isBlockedRow,
              '!bg-opacity-5 !bg-nordic-blue': isRecentlyChangedRow
            }"
            (columnVisible)="onColumnChange($event)"
            (columnMoved)="onColumnChange($event)"
            (sortChanged)="onColumnChange($event)"
          ></ag-grid-angular>
        </div>
      </div>
    </ng-container>
    <div
      class="flex flex-col items-center justify-start gap-4 p-4 pl-0 md:flex-row"
    >
      <button
        mat-raised-button
        color="primary"
        [disabled]="
          !(hasEditorRole$ | ngrxPush) ||
          !editableClass(navigation.materialClass)
        "
        (click)="openDialog(false)"
        *ngIf="!(hasMinimizedDialog$ | ngrxPush); else resumeButton"
      >
        <mat-icon class="material-icons-outlined">add</mat-icon>
        <span>{{ t('addItem') }}</span>
      </button>
      <ng-template #resumeButton>
        <button
          mat-raised-button
          class="!bg-nordic-blue"
          [disabled]="
            !(hasEditorRole$ | ngrxPush) ||
            !editableClass(navigation.materialClass)
          "
          (click)="resumeDialog()"
        >
          <mat-icon class="text-white">play_arrow</mat-icon>
          <span class="text-white">{{ t('resume') }}</span>
        </button>
      </ng-template>

      <button mat-button color="primary" (click)="exportExcel()">
        <mat-icon class="material-icons-outlined">download</mat-icon>
        <span>{{ t('export') }}</span>
      </button>
      <button
        mat-button
        color="primary"
        [disabled]="isDefaultAgGridFilter()"
        (click)="resetForm()"
      >
        <mat-icon class="material-icons-outlined">sync</mat-icon>
        <span>{{ t('resetTable') }}</span>
      </button>
      <div class="flex flex-grow flex-row items-center justify-start gap-4">
        <div class="flex flex-col">
          <div class="text-caption text-low-emphasis">
            {{
              t('allClass', {
                class: t(navigation.navigationLevel)
              })
            }}
          </div>
          <div class="text-caption text-high-emphasis">
            {{ resultCount$ | ngrxPush }}
          </div>
        </div>
        <div class="flex flex-col">
          <div class="text-caption text-low-emphasis">{{ t('subtotal') }}</div>
          <div class="text-caption text-high-emphasis">
            {{ agGridApi?.getDisplayedRowCount() || 0 }}
          </div>
        </div>
      </div>
      <button mat-button color="primary" (click)="fetchResult()">
        <mat-icon class="material-icons-outlined">refresh</mat-icon>
        <span>{{ t('reload') }}</span>
      </button>
    </div>
  </div>
  <ng-container
    *ngIf="(optionsLoading$ | ngrxPush) || (resultLoading$ | ngrxPush)"
  >
    <div class="fixed flex h-full w-full flex-col items-center md:pt-[10%]">
      <mat-spinner></mat-spinner>
    </div>
  </ng-container>
</div>
