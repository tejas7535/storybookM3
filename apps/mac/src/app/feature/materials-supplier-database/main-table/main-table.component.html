<div class="flex h-full w-full">
  <div class="flex w-full flex-1 flex-col gap-6 p-6 py-8">
    <ng-container *ngIf="!(optionsLoading$ | ngrxPush); else loading">
      <div class="flex flex-row">
        <h6>Please choose your class and category</h6>
      </div>
      <div class="flex flex-col md:gap-8 lg:flex-row">
        <div class="flex flex-row gap-6">
          <mat-form-field appearance="fill" class="w-80">
            <mat-label>Material Class</mat-label>
            <mat-select
              [formControl]="materialClassSelectionControl"
              [compareWith]="compareDataFilters"
            >
              <mat-option [value]="{ id: undefined, name: undefined }">
                All
              </mat-option>
              <mat-option
                *ngFor="let option of materialClassOptions$ | ngrxPush"
                [value]="option"
              >
                {{ option.name | titlecase }}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="fill" class="w-80">
            <mat-label>Product Category</mat-label>
            <mat-select
              [formControl]="productCategorySelectionControl"
              [compareWith]="compareDataFilters"
              multiple
            >
              <div class="flex h-12 flex-row place-items-center px-4">
                <mat-checkbox
                  class="w-full"
                  [formControl]="allCategoriesSelectedControl"
                  color="primary"
                  #selectAllCheckbox
                  >Select All</mat-checkbox
                >
              </div>
              <mat-option
                [value]="{ id: undefined, name: 'empty' }"
                #categoryOption
                >(Blanks)</mat-option
              >
              <mat-option
                *ngFor="let option of productCategoryOptions$ | ngrxPush"
                [value]="option"
                #categoryOption
              >
                {{ option.name | titlecase }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div class="flex grow flex-row justify-between gap-4">
          <div class="flex flex-row place-items-center gap-4">
            <button
              mat-raised-button
              [disabled]="!filterForm.valid"
              class="my-auto"
              color="primary"
              (click)="fetchMaterials()"
            >
              Start Search
            </button>
            <button
              mat-stroked-button
              [disabled]="filterForm.pristine"
              class="my-auto"
              color="primary"
              (click)="resetForm()"
            >
              Reset All
            </button>
          </div>
          <!-- find replacement for bg-[#E5F4E9] -->
          <div
            *ngIf="co2ColumnVisible$ | ngrxPush"
            class="my-auto flex flex-row rounded-md bg-surface"
          >
            <div
              class="my-auto flex flex-row gap-4 rounded-md border border-[#4398AF] bg-[#ECF5F7] p-3"
            >
              <mat-icon class="material-icons-outlined text-[#4398AF]"
                >info_outline</mat-icon
              >
              <div class="max-w-sm text-caption">
                Presented CO2 values are for internal use only - data must not
                be used for communication with customers
              </div>
            </div>
          </div>
        </div>
      </div>
      <ng-container *ngIf="!(resultLoading$ | ngrxPush); else loading">
        <mat-card class="msd-card" *ngIf="result$ | ngrxPush">
          <div class="flex w-full flex-1 flex-col gap-4">
            <div
              class="flex w-full flex-row-reverse place-items-center justify-between"
            >
              <button mat-icon-button [matMenuTriggerFor]="tableMenu">
                <mat-icon>more_vert</mat-icon>
              </button>
              <mat-menu #tableMenu="matMenu">
                <button mat-menu-item (click)="resetAgGridFilter()">
                  <span>Reset table filter</span>
                </button>
                <button
                  mat-menu-item
                  (click)="resetAgGridColumnConfiguration()"
                >
                  <span>Reset column configuration</span>
                </button>
                <button mat-menu-item (click)="fetchMaterials()">
                  <span>Refresh</span>
                </button>
              </mat-menu>
              <h6 *ngIf="result$ | ngrxPush" class="text-medium-emphasis">
                All
                {{ selectedClass || 'Material Classes' }}
                x
                {{ selectedCategory || 'All Product Categories' }}
                ({{ rowCount ? rowCount : 0 }})
              </h6>
            </div>
            <div
              class="flex h-[232px] w-full flex-row"
              *ngIf="filterLists$ | ngrxPush"
            >
              <div class="flex w-1/3 flex-col gap-2">
                <div class="h-6">
                  <div class="pl-4 text-subtitle-2 text-medium-emphasis">
                    Material name
                  </div>
                </div>

                <div
                  class="msd-scrollbar h-40 overflow-y-scroll border-l border-t border-b border-solid border-border lg:h-[200px]"
                >
                  <mat-selection-list
                    class="msd-list"
                    #materialNames
                    [multiple]="false"
                    [formControl]="materialNameFilterList"
                  >
                    <mat-list-option selected
                      >All ({{
                        (filterLists$ | ngrxPush).materialNames.length
                      }})</mat-list-option
                    >
                    <mat-list-option
                      *ngFor="
                        let materialName of (filterLists$ | ngrxPush)
                          .materialNames
                      "
                      [value]="materialName"
                      >{{ materialName }}</mat-list-option
                    >
                  </mat-selection-list>
                </div>
              </div>
              <div class="flex w-1/3 flex-col gap-2">
                <div class="h-6">
                  <div class="pl-4 text-subtitle-2 text-medium-emphasis">
                    Group Standard
                  </div>
                </div>
                <div
                  class="msd-scrollbar h-40 overflow-y-scroll border-t border-b border-solid border-border lg:h-[200px]"
                >
                  <mat-selection-list
                    class="msd-list"
                    #materialStandard
                    [multiple]="false"
                    [formControl]="standardDocumentFilterList"
                  >
                    <mat-list-option selected
                      >All ({{
                        (filterLists$ | ngrxPush).materialStandards.length
                      }})</mat-list-option
                    >
                    <mat-list-option
                      *ngFor="
                        let materialStandard of (filterLists$ | ngrxPush)
                          .materialStandards
                      "
                      [value]="materialStandard"
                      >{{ materialStandard }}</mat-list-option
                    >
                  </mat-selection-list>
                </div>
              </div>
              <div class="flex w-1/3 flex-col gap-2">
                <div class="h-6">
                  <div class="pl-4 text-subtitle-2 text-medium-emphasis">
                    Material Number
                  </div>
                </div>
                <div
                  class="msd-scrollbar h-40 overflow-y-scroll border-r border-t border-b border-solid border-border lg:h-[200px]"
                >
                  <mat-selection-list
                    class="msd-list"
                    #materialNumbers
                    [multiple]="false"
                    [formControl]="materialNumbersFilterList"
                  >
                    <mat-list-option selected
                      >All ({{
                        (filterLists$ | ngrxPush).materialNumbers.length
                      }})</mat-list-option
                    >
                    <mat-list-option
                      *ngFor="
                        let materialNumber of (filterLists$ | ngrxPush)
                          .materialNumbers
                      "
                      [value]="materialNumber"
                      >{{ materialNumber }}</mat-list-option
                    >
                  </mat-selection-list>
                </div>
              </div>
            </div>
            <ag-grid-angular
              class="ag-theme-material h-full"
              [columnDefs]="columnDefs"
              [defaultColDef]="defaultColDef"
              [modules]="modules"
              [sideBar]="sidebar"
              [enableCellTextSelection]="true"
              [rowData]="result$ | ngrxPush"
              (gridReady)="onGridReady($event)"
              (filterChanged)="onFilterChange($event)"
              (firstDataRendered)="setAgGridFilter($event)"
              (columnMoved)="onColumnChange($event)"
              (sortChanged)="onColumnChange($event)"
              (columnVisible)="onColumnChange($event)"
            ></ag-grid-angular>
          </div>
        </mat-card>
      </ng-container>
    </ng-container>
    <ng-template #loading>
      <div
        class="flex h-full w-full flex-1 flex-col place-items-center justify-center"
      >
        <mat-spinner></mat-spinner>
      </div>
    </ng-template>
  </div>
</div>
