<!-- <pre>{{ dialog | json }}</pre> -->

<ng-container *transloco="let t; read: 'form'">
  <cae-dynamic-form
    [description]="dialog"
    [model]="model"
    [object]="object"
    (loaded)="dynamicFormLoaded($event)"
  >
    <div
      *caeLayout="let metaArray; let pages = pages; let form = form"
      class="content"
    >
      <mm-pages-stepper
        #stepper
        [pages]="pages"
        [maxPageId]="maxPageId$ | ngrxPush"
        [activePageId]="activePageId$ | ngrxPush"
        [inactivePageId]="inactivePageId$ | ngrxPush"
        (activePageIdChange)="homeStore.setActivePageId($event)"
      >
      </mm-pages-stepper>

      <div class="w-full">
        <ng-container
          *ngIf="(activePageId$ | ngrxPush) === RSY_PAGE_BEARING_TYPE"
        >
          <mm-bearing-search
            (bearing)="selectBearing($event)"
          ></mm-bearing-search>
          <schaeffler-horizontal-separator
            [text]="t('searchManually')"
          ></schaeffler-horizontal-separator>
        </ng-container>

        <ng-container
          *ngFor="let pagedMeta of pagedMetas$ | ngrxPush; index as pageIndex"
        >
          <ng-container
            *ngIf="pagedMeta.page.id === (activePageId$ | ngrxPush)"
          >
            <ng-container *ngFor="let meta of pagedMeta.metas">
              <div
                *ngIf="
                  meta.page.visible && !isCalculationOptions(pagedMeta.page.id)
                "
              >
                <h6
                  *ngIf="
                    meta.member.text &&
                    meta.page.id !== PROPERTY_PAGE_MOUNTING_SITUATION_SUB &&
                    meta.page.id !== PROPERTY_PAGE_MOUNTING
                  "
                >
                  {{ meta.member.text }}
                </h6>
                <cae-member-control
                  [class.wide]="!meta.member.text"
                  [meta]="meta"
                ></cae-member-control>
              </div>
            </ng-container>

            <mm-calculation-options
              *ngIf="isCalculationOptions(pagedMeta.page.id)"
              [pageMeta]="pagedMeta"
            ></mm-calculation-options>

            <ng-container *ngrxLet="pagedMetas$ as pagedMetas">
              <button
                mat-raised-button
                *ngIf="stepper.hasNext"
                [disabled]="!(pagedMeta.valid$ | ngrxPush)"
                (click)="
                  next(pagedMeta.page.id, pagedMetas, stepper);
                  stepper.hasResultNext && resultPage.send(form)
                "
                class="text-button uppercase w-full md:w-auto"
              >
                {{
                  stepper.hasResultNext
                    ? t('calculateResults')
                    : t('select', { fieldname: activePageName$ | ngrxPush })
                }}
              </button>
            </ng-container>
          </ng-container>
        </ng-container>

        <mm-result-page
          [active]="!stepper.hasNext"
          #resultPage
        ></mm-result-page>
        <!-- <pre>{{ form | json }}</pre> -->
      </div>
    </div>
  </cae-dynamic-form>
</ng-container>
