<div *transloco="let t">
  <!-- title -->
  <div mat-dialog-title class="m-0 pt-0">
    <h2 class="text-title-large">{{ t(title) }}</h2>
  </div>

  <!-- content -->
  <mat-dialog-content>
    @if (loading() || (selectableOptionsService.loading$ | ngrxPush)) {
      <!-- loading spinner -->
      <div>
        <schaeffler-loading-spinner [useBearingLoadingSpinner]="true" />
      </div>
    } @else {
      <div class="grid grid-cols-1 md:grid-cols-3 md:gap-x-4">
        <!-- row 1 -->
        <!-- alertType -->
        <d360-single-autocomplete-pre-loaded
          [form]="formGroup"
          [control]="$any(formGroup.controls.type)"
          [label]="t(translationStart + '.type', {})"
          [optionsLoadingResult]="getOptions('alertTypesForRuleEditor')"
          [getOptionLabelInTag]="displayFnText"
          (selectionChange)="updateForm($event, 'type')"
        />

        <!-- region -->
        <d360-filter-dropdown
          [form]="formGroup"
          [control]="$any(formGroup.controls.region)"
          [label]="t(translationStart + '.region', {})"
          [options]="getOptions('region').options"
          [formatOptionValue]="displayFnText"
          (selectionChange)="
            updateForm(
              { option: $event ? $any($event) : { id: null } },
              'region'
            )
          "
        />
        <!-- row 2 -->
        <!-- salesArea -->
        <d360-filter-dropdown
          [form]="formGroup"
          [control]="$any(formGroup.controls.salesArea)"
          [label]="t(translationStart + '.sales_area', {})"
          [options]="getOptions('salesArea').options"
          (selectionChange)="
            updateForm(
              { option: $event ? $any($event) : { id: null } },
              'salesArea'
            )
          "
          [addClearButton]="true"
          class="col-start-1 col-end-1"
        />

        <!-- salesOrg -->
        <d360-single-autocomplete-pre-loaded
          [form]="formGroup"
          [control]="$any(formGroup.controls.salesOrg)"
          [label]="t(translationStart + '.sales_org', {})"
          [optionsLoadingResult]="getOptions('salesOrg')"
          (selectionChange)="updateForm($event, 'salesOrg')"
          [addClearButton]="true"
        />

        <!-- sectorManagement -->
        <d360-filter-dropdown
          [form]="formGroup"
          [control]="$any(formGroup.controls.sectorManagement)"
          [label]="t(translationStart + '.sector_management', {})"
          [options]="getOptions('sectorMgmt').options"
          (selectionChange)="
            updateForm(
              { option: $event ? $any($event) : { id: null } },
              'sectorManagement'
            )
          "
          [addClearButton]="true"
        />
        <!-- row 3 -->
        <!-- demandPlanner -->
        <d360-single-autocomplete-pre-loaded
          [form]="formGroup"
          [control]="$any(formGroup.controls.demandPlannerId)"
          [label]="t(translationStart + '.demandPlanner', {})"
          [optionsLoadingResult]="getOptions('demandPlanners')"
          (selectionChange)="updateForm($event, 'demandPlannerId')"
          [addClearButton]="true"
        />

        <!-- gkamNumber -->
        <d360-single-autocomplete-pre-loaded
          [form]="formGroup"
          [control]="$any(formGroup.controls.gkamNumber)"
          [label]="t(translationStart + '.gkam', {})"
          [optionsLoadingResult]="getOptions('gkam')"
          (selectionChange)="updateForm($event, 'gkamNumber')"
          [addClearButton]="true"
        />

        <!-- customerNumber -->
        <d360-single-autocomplete-on-type
          [form]="formGroup"
          [control]="$any(formGroup.controls.customerNumber)"
          [label]="t(translationStart + '.customer', {})"
          urlBegin="global-selection/search-customers"
          (selectionChange)="updateForm($event, 'customerNumber')"
          [addClearButton]="true"
        />
        <!-- row 4 -->
        <!-- materialClassification -->
        <d360-filter-dropdown
          [form]="formGroup"
          [control]="$any(formGroup.controls.materialClassification)"
          [label]="t(translationStart + '.materialClassification', {})"
          [options]="materialClassificationOptions"
          (selectionChange)="
            updateForm(
              { option: $event ? $any($event) : { id: null } },
              'materialClassification'
            )
          "
          [addClearButton]="true"
        />

        <!-- productLine -->
        <d360-single-autocomplete-pre-loaded
          [form]="formGroup"
          [control]="$any(formGroup.controls.productLine)"
          [label]="t(translationStart + '.product_line', {})"
          [optionsLoadingResult]="getOptions('productLine')"
          (selectionChange)="updateForm($event, 'productLine')"
          [addClearButton]="true"
        />

        <!-- productionLine -->
        <d360-single-autocomplete-on-type
          [form]="formGroup"
          [control]="$any(formGroup.controls.productionLine)"
          [label]="t(translationStart + '.production_line', {})"
          urlBegin="global-selection/search-production-line"
          (selectionChange)="updateForm($event, 'productionLine')"
          [addClearButton]="true"
        />

        <!-- row 5 -->
        <!-- materialNumber -->
        <d360-single-autocomplete-on-type
          [control]="$any(formGroup.controls.materialNumber)"
          [form]="formGroup"
          [label]="t(translationStart + '.material', {})"
          urlBegin="global-selection/search-materials"
          (selectionChange)="updateForm($event, 'materialNumber')"
          [addClearButton]="true"
        />

        <!-- row 6 (not always visible) -->
        @if (alertTypeDescription) {
          <div
            class="grid grid-cols-subgrid md:col-span-3 md:grid-cols-3 md:gap-4 md:gap-y-6"
          >
            <div class="col-span-1 md:col-span-3 mt-4 mb-8 md:mb-3">
              <hr />
            </div>
            <!-- threshold1 -->
            @if (formGroup.controls.threshold1.enabled) {
              <mat-form-field [formGroup]="formGroup" appearance="outline">
                <mat-label>{{ getThresholdDescription(1) }}</mat-label>
                <input
                  [attr.aria-label]="getThresholdDescription(1)"
                  matInput
                  [formControl]="$any(formGroup.controls.threshold1)"
                  d360NumberSeparator
                />
                @if (formGroup.controls.threshold1.hasError('required')) {
                  <mat-error>{{ missingFields }}</mat-error>
                }
              </mat-form-field>
            }

            <!-- threshold2 -->
            @if (formGroup.controls.threshold2.enabled) {
              <mat-form-field [formGroup]="formGroup" appearance="outline">
                <mat-label>{{ getThresholdDescription(2) }}</mat-label>
                <input
                  [attr.aria-label]="getThresholdDescription(2)"
                  matInput
                  [formControl]="$any(formGroup.controls.threshold2)"
                  d360NumberSeparator
                />
                @if (formGroup.controls.threshold2.hasError('required')) {
                  <mat-error>{{ missingFields }}</mat-error>
                }
              </mat-form-field>
            }

            <!-- threshold3 -->
            @if (formGroup.controls.threshold3.enabled) {
              <mat-form-field [formGroup]="formGroup" appearance="outline">
                <mat-label>{{ getThresholdDescription(3) }}</mat-label>
                <input
                  [attr.aria-label]="getThresholdDescription(3)"
                  matInput
                  [formControl]="$any(formGroup.controls.threshold3)"
                  d360NumberSeparator
                />
                @if (formGroup.controls.threshold3.hasError('required')) {
                  <mat-error>{{ missingFields }}</mat-error>
                }
              </mat-form-field>
            }
          </div>
        }

        <!-- row 7 -->
        <div
          class="grid grid-cols-subgrid md:col-span-3 md:grid-cols-4 md:gap-4 md:gap-y-6"
        >
          <div class="col-span-1 md:col-span-4 mt-4 mb-8 md:mb-4">
            <hr />
          </div>
          <!-- startDate-->
          <d360-date-picker
            [control]="$any(formGroup.controls.startDate)"
            [label]="t(translationStart + '.start')"
          />

          <!-- execInterval -->
          <d360-filter-dropdown
            [form]="formGroup"
            [control]="$any(formGroup.controls.execInterval)"
            [label]="t(translationStart + '.interval.rootString', {})"
            [options]="execIntervalOptions.options"
            [formatOptionValue]="displayFnText"
            [formatSelectedValue]="displayFnText"
            (selectionChange)="onIntervalSelectionChange($any($event))"
          />

          <!-- execDay -->
          <div>
            <mat-form-field [formGroup]="formGroup" appearance="outline">
              <mat-label>{{
                t(translationStart + '.when.rootString', {})
              }}</mat-label>
              <mat-select
                [aria-label]="t(translationStart + '.when.rootString', {})"
                [formControl]="$any(formGroup.controls.execDay)"
                (selectionChange)="
                  updateForm(
                    { option: $any({ id: formGroup.controls.execDay.value }) },
                    'execDay'
                  )
                "
              >
                @for (option of execDayOptions; track option) {
                  <mat-option [value]="option">
                    {{ t(translationStart + '.when.' + option, {}) }}
                  </mat-option>
                }
              </mat-select>
              @if (formGroup.controls.execDay.hasError('required')) {
                <mat-error>{{ missingFields }}</mat-error>
              }
            </mat-form-field>
          </div>
          <!-- endDate -->
          <d360-date-picker
            [control]="$any(formGroup.controls.endDate)"
            [label]="t(translationStart + '.end')"
          />
        </div>

        <!-- row 8 -->
        <!-- alertComment -->

        <mat-form-field
          [formGroup]="formGroup"
          appearance="outline"
          class="compact styled-text-field md:col-span-3"
        >
          <mat-label>{{ t(translationStart + '.comment', {}) }}</mat-label>
          <textarea
            matInput
            cdkTextareaAutosize
            cdkAutosizeMinRows="4"
            #autosize="cdkTextareaAutosize"
            [formControl]="$any(formGroup.controls.alertComment)"
            rows="4"
            (blur)="
              updateForm(
                {
                  option: $any({ id: formGroup.controls.alertComment.value })
                },
                'alertComment'
              )
            "
          ></textarea>
        </mat-form-field>
      </div>
    }
  </mat-dialog-content>

  <!--  buttons -->
  <mat-dialog-actions align="end">
    <!-- close button -->
    <button mat-button (click)="handleOnClose([])">
      {{ t('button.close') }}
    </button>

    <!-- save button -->
    <button
      (click)="onSave()"
      mat-flat-button
      color="primary"
      [disabled]="loading() || (selectableOptionsService.loading$ | ngrxPush)"
    >
      {{ t('button.save') }}
    </button>
  </mat-dialog-actions>
</div>
