<ng-container *transloco="let t; read: 'calculationResultReport'">
  <div mat-dialog-title>
    <div
      class="ea-flex ea-flex-row ea-content-around ea-justify-between ea-pb-2 ea-pr-2"
    >
      <div class="ea-text-h6 ea-text-high-emphasis ea-my-auto">
        {{
          t('dialogTitle', {
            bearingDesignation: bearingDesignation$ | ngrxPush
          })
        }}
      </div>
      <div class="ea-flex ea-flex-row">
        <button mat-icon-button (click)="closeDialog()">
          <mat-icon class="ea-text-medium-emphasis">close</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <mat-dialog-content class="ea-h-full md:ea-px-6 ea-px-2">
    <div class="ea-flex ea-h-full ea-flex-row">
      <div>
        <!-- CO2 Emissions -->
        <ng-container
          *ngIf="calculationResultFacade.isEmissionResultAvailable$ | ngrxPush"
        >
          <mat-expansion-panel
            id="emissions"
            *transloco="let t; read: 'calculationResultReport.co2Emissions'"
            class="ea-border-border ea-w-full ea-border !ea-shadow-none"
            [expanded]="
              (selctedCalculationTypes$ | ngrxPush)?.emission?.selected === true
            "
          >
            <mat-expansion-panel-header class="ea-h-[64px]">
              <mat-panel-title>
                <div class="ea-flex ea-flex-row">
                  <div class="ea-my-auto">
                    <mat-icon color="primary" svgIcon="co2"></mat-icon>
                  </div>
                  <div class="ea-my-auto ea-ml-2">
                    {{ t('title') }}
                  </div>
                </div>
              </mat-panel-title>
            </mat-expansion-panel-header>

            <div
              class="ea-full-w ea-full-h !ea--mx-6 !ea--mb-4"
              *ngIf="
                calculationResultFacade.calculationReportCO2Emission$
                  | ngrxPush as co2Emissions
              "
            >
              <div
                class="ea-text-body-2 ea-border-border ea-flex ea-w-full ea-flex-col md:ea-flex-row ea-border-t"
              >
                <!-- Chart -->
                <div
                  class="ea-border-border ea-flex ea-flex-shrink-0 ea-flex-col ea-items-center ea-border-r ea-p-2 md:ea-p-8"
                >
                  <div class="ea-text-high-emphasis ea-mb-2">
                    {{ t('chartTitle') }}
                  </div>
                  <div
                    *ngIf="co2EmissionOptions$ | async as co2EmissionOptions"
                    echarts
                    class="ea-h-[200px] ea-w-[200px]"
                    [options]="co2EmissionOptions"
                    [initOpts]="{
                      width: 200,
                      height: 200
                    }"
                  ></div>

                  <div class="ea-text-medium-emphasis ea-mh-2">
                    {{ t('chartDesc') }}
                  </div>
                </div>
                <div class="ea-flex ea-flex-grow ea-flex-col">
                  <!-- Upstream -->
                  <div
                    class="ea-border-border ea-w-full ea-border-t md:ea-border-t-0 ea-border-b ea-px-4 md:ea-px-8 ea-py-4"
                  >
                    <div
                      class="ea-text-high-emphasis ea-flex ea-flex-row ea-items-center ea-pb-4"
                    >
                      <ea-tag
                        value=""
                        styleClass="ea-bg-[#DDE86E]"
                        class="ea-mr-2"
                      ></ea-tag>

                      {{ t('upstreamTitle') }}
                    </div>
                    <div
                      class="ea-flex ea-w-full ea-flex-row md:ea-justify-start ea-items-center ea-justify-center"
                    >
                      <div
                        class="ea-flex ea-flex-row ea-items-center ea-justify-center ea-py-2 ea-pr-4"
                      >
                        <div class="ea-text-h6 ea-text-high-emphasis">
                          {{
                            (co2Emissions?.co2_upstream | number: '1.2-2') ||
                              '-'
                          }}
                        </div>
                        <div
                          class="ea-text-body-2 ea-text-high-emphasis ea-pl-1"
                        >
                          kg
                        </div>
                      </div>
                      <mat-divider [vertical]="true"></mat-divider>
                      <div
                        class="ea-flex ea-flex-row ea-items-center ea-justify-center ea-py-2 ea-pl-4"
                      >
                        <div class="ea-text-h6 ea-text-high-emphasis">
                          {{
                            (co2Emissions?.co2_upstream_percent * 100
                              | number: '1.2-2') || '-'
                          }}
                        </div>
                        <div
                          class="ea-text-body-2 ea-text-high-emphasis ea-pl-1"
                        >
                          %
                        </div>
                      </div>
                    </div>
                    <div class="ea-text-medium-emphasis ea-pt-4">
                      {{ t('upstreamHint') }} -
                      <a
                        class="ea-text-primary"
                        [href]="t('upstreamHintLink')"
                        target="_blank"
                        >{{ t('upstreamHintLinkText') }}</a
                      >
                    </div>
                  </div>

                  <!-- Downstream -->
                  <div class="ea-w-full ea-px-4 md:ea-px-8 ea-py-4">
                    <div
                      class="ea-text-high-emphasis ea-flex ea-flex-row ea-items-center ea-pb-4"
                    >
                      <ea-tag
                        value=""
                        styleClass="ea-bg-[#7DC882]"
                        class="ea-mr-2"
                      ></ea-tag>
                      {{ t('downstreamTitle') }}
                    </div>
                    <div
                      class="ea-flex ea-w-full ea-flex-row md:ea-justify-start ea-justify-center ea-items-center"
                    >
                      <div
                        class="ea-flex ea-flex-row ea-items-center ea-justify-center ea-py-2 ea-pr-4"
                      >
                        <div class="ea-text-h6 ea-text-high-emphasis">
                          {{
                            (co2Emissions?.co2_downstream | number: '1.2-2') ||
                              '-'
                          }}
                        </div>
                        <div
                          class="ea-text-body-2 ea-text-high-emphasis ea-pl-1"
                        >
                          kg
                        </div>
                      </div>
                      <mat-divider [vertical]="true"></mat-divider>
                      <div
                        class="ea-flex ea-flex-row ea-items-center ea-justify-center ea-py-2 ea-pl-4"
                      >
                        <div class="ea-text-h6 ea-text-high-emphasis">
                          {{
                            (co2Emissions?.co2_downstream_percent * 100
                              | number: '1.2-2') || '-'
                          }}
                        </div>
                        <div
                          class="ea-text-body-2 ea-text-high-emphasis ea-pl-1"
                        >
                          %
                        </div>
                      </div>
                    </div>
                    <div class="ea-text-medium-emphasis ea-pt-4"></div>
                  </div>
                </div>
              </div>
              <div
                class="ea-border-border ea-flex ea-flex-row ea-items-center ea-border-t ea-px-4 ea-py-2"
              >
                <div class="ea-mr-2 ea-flex-shrink-0">
                  <mat-icon color="primary">info_outline</mat-icon>
                </div>
                <div class="ea-text-body-2 ea-text-medium-emphasis">
                  {{ t('calculationHint') }} -
                  <a
                    class="ea-text-primary"
                    [href]="t('calculationHintLink')"
                    target="_blank"
                    >{{ t('calculationHintLinkText') }}</a
                  >
                </div>
              </div>
            </div>
          </mat-expansion-panel>
        </ng-container>

        <!-- Frictional power loss -->
        <ng-container
          *ngIf="calculationResultFacade.isFrictionResultAvailable$ | ngrxPush"
        >
          <mat-expansion-panel
            id="friction"
            *transloco="
              let t;
              read: 'calculationResultReport.frictionalPowerloss'
            "
            class="ea-border-border ea-w-full ea-border !ea-shadow-none ea-mt-4"
            [expanded]="
              (selctedCalculationTypes$ | ngrxPush)?.friction?.selected === true
            "
          >
            <mat-expansion-panel-header class="ea-h-[64px]">
              <mat-panel-title>
                <div class="ea-flex ea-flex-row">
                  <div class="ea-my-auto">
                    <mat-icon color="primary">compress</mat-icon>
                  </div>
                  <div class="ea-my-auto ea-ml-2">
                    {{ t('title') }}
                  </div>
                </div>
              </mat-panel-title>
            </mat-expansion-panel-header>

            <div
              class="ea-full-w ea-full-h !ea--mx-6 !ea--mb-4"
              *ngIf="
                calculationResultFacade.calculationReportFrictionalPowerloss$
                  | ngrxPush as frictionalPowerloss
              "
            >
              <ng-container
                *transloco="
                  let t;
                  read: 'calculationResultReport.frictionalPowerloss'
                "
              >
                <div class="ea-grid ea-grid-cols-2 ea-gap-0 ea-px-4 md:ea-px-8">
                  <ng-container
                    *ngFor="let item of frictionalPowerloss; let index = index"
                  >
                    <div
                      class="ea-flex ea-flex-col ea-justify-start ea-border-border md:ea-border-b-0 ea-border-b md:ea-mx-2 ea-py-4 md:ea-py-2"
                      [ngClass]="{
                        'md:ea-border-r ea-border-r-0 md:ea-mr-4 ea-pl-4 md:ea-pl-0':
                          index % 2 !== 1,
                        'md:ea-border-r-0 ea-border-r md:ea-mr-4 ea-pr-4 md:ea-pr-0':
                          index % 2 === 1,
                        'ea-col-span-2 md:ea-col-span-1 !ea-pl-0': index === 0
                      }"
                    >
                      <div class="ea-mb-4">
                        <ea-tag
                          [value]="item.short"
                          styleClass="ea-text-[#007892] ea-bg-[#F0F6FA]"
                        ></ea-tag>
                      </div>
                      <div
                        class="ea-flex ea-flex-row ea-items-center ea-justify-start"
                      >
                        <div
                          class="ea-text-h6 ea-text-high-emphasis"
                          [class.!ea-text-h4]="index === 0"
                        >
                          {{ (item.value | number: '1.0-2') || '-' }}
                        </div>
                        <div
                          class="ea-text-body-2 ea-text-high-emphasis ea-pl-1"
                        >
                          {{ item.unit }}
                        </div>
                      </div>

                      <div
                        class="ea-text-caption ea-text-medium-emphasis ea-mt-4"
                      >
                        {{ t(item.title) }}
                      </div>
                    </div>
                    <div
                      class="ea-border-t ea-border-border ea-my-4 ea-h-[1px] ea-col-span-2 md:ea-block ea-hidden"
                      *ngIf="index % 2 === 1"
                    ></div>
                  </ng-container>
                </div>
              </ng-container>
            </div>
          </mat-expansion-panel>
        </ng-container>
      </div>

      <!-- Right Hand Navigation -->
      <div
        class="ea-text-medium-emphasis ea-ml-8 md:ea-flex md:ea-w-[250px] ea-h-full ea-mb-auto ea-flex-row ea-hidden"
        *transloco="let t; read: 'calculationSelection'"
      >
        <mat-divider [vertical]="true"></mat-divider>
        <div class="ea-my-2 ea-ml-8 ea-mr-4 ea-w-full">
          <div class="ea-mb-2">
            <div class="ea-flex ea-items-center ea-justify-center">
              <mat-icon class="ea-mr-2 ea-flex-shrink-0">calculate</mat-icon>
              <div>{{ t('calculations') }}</div>
            </div>
          </div>
          <mat-divider></mat-divider>
          <div
            class="ea-flex ea-pt-4 ea-flex-col"
            *ngIf="
              calculationResultFacade.getSelectedCalculations$
                | ngrxPush as getSelectedCalculations
            "
          >
            <div
              *ngFor="let config of getSelectedCalculations"
              (click)="scrollIntoView(config.name)"
              class="hover:ea-bg-secondary-100 hover:ea-text-primary ea-mt-4 ea-flex ea-w-full ea-flex-row ea-items-center ea-px-4 ea-py-2 hover:ea-rounded ea-cursor-pointer"
            >
              <mat-icon
                class="ea-mr-2 ea-flex-shrink-0"
                [svgIcon]="config.svgIcon"
                >{{ config.icon }}</mat-icon
              >
              <div class="ea-text-subtitle-2 ea-whitespace-normal">
                {{ t(config.label) }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </mat-dialog-content>
</ng-container>

<ng-template #loadingTemplate>
  <div class="ea-item-center ea-flex ea-content-center ea-p-8">
    <div class="ea-ml-auto ea-mr-auto">
      <mat-spinner diameter="20"></mat-spinner>
    </div>
  </div>
</ng-template>
