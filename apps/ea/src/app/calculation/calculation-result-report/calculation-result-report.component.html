<ng-container *transloco="let t; read: 'calculationResultReport'">
  <div mat-dialog-title>
    <div class="flex flex-row content-around justify-between pb-2 pr-2">
      <div class="text-h6 text-high-emphasis my-auto">
        {{
          t('dialogTitle', {
            bearingDesignation: bearingDesignation$ | ngrxPush
          })
        }}
      </div>
      <div class="flex flex-row">
        <button mat-icon-button (click)="closeDialog()">
          <mat-icon class="text-medium-emphasis">close</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <mat-dialog-content class="h-full md:px-6 px-2">
    <div class="flex h-full flex-row">
      <div>
        <!-- Frictional power loss -->
        <ng-container
          *ngIf="calculationResultFacade.isFrictionResultAvailable$ | ngrxPush"
        >
          <mat-expansion-panel
            id="friction"
            *transloco="
              let t;
              read: 'calculationResultReport.frictionalPowerloss'
            "
            class="border-border w-full border !shadow-none mb-4"
            [expanded]="
              (selctedCalculationTypes$ | ngrxPush)?.frictionalPowerloss
                .selected === true
            "
          >
            <mat-expansion-panel-header class="h-[64px]">
              <mat-panel-title>
                <div class="flex flex-row">
                  <div class="my-auto">
                    <mat-icon color="primary">compress</mat-icon>
                  </div>
                  <div class="my-auto ml-2">
                    {{ t('title') }}
                  </div>
                </div>
              </mat-panel-title>
            </mat-expansion-panel-header>

            <div
              class="full-w full-h !-mx-6 !-mb-4"
              *ngIf="
                calculationResultFacade.calculationReportFrictionalPowerloss$
                  | ngrxPush as frictionalPowerloss
              "
            >
              <ng-container
                *transloco="
                  let t;
                  read: 'calculationResultReport.frictionalPowerloss'
                "
              >
                <div
                  class="grid grid-cols-2 gap-0 px-4 md:px-8 py-4 border-border border-t"
                >
                  <ng-container
                    *ngFor="let item of frictionalPowerloss; let index = index"
                  >
                    <div
                      class="flex flex-col justify-start border-border md:border-b-0 border-b md:mx-2 py-4 md:py-2"
                      [ngClass]="{
                        'md:border-r border-r-0 md:mr-4 pl-4 md:pl-0':
                          index % 2 !== 1,
                        'md:border-r-0 border-r md:mr-4 pr-4 md:pr-0':
                          index % 2 === 1,
                        'col-span-2 md:col-span-1 !pl-0': index === 0
                      }"
                    >
                      <div class="mb-4">
                        <ea-tag
                          [value]="item.short"
                          styleClass="text-[#007892] bg-[#F0F6FA]"
                        ></ea-tag>
                      </div>
                      <div class="flex flex-row items-end justify-start">
                        <div
                          class="text-high-emphasis"
                          [class.text-h4]="index === 0"
                          [class.text-h6]="index !== 0"
                        >
                          {{ (item.value | meaningfulRound) || '-' }}
                        </div>
                        <div class="text-body-2 text-high-emphasis pl-1">
                          {{ item.unit }}
                        </div>
                      </div>

                      <div class="text-caption text-medium-emphasis mt-4">
                        {{ t(item.title) }}
                      </div>
                    </div>
                    <div
                      class="border-t border-border my-4 h-[1px] col-span-2 md:block hidden"
                      *ngIf="index % 2 === 1"
                    ></div>
                  </ng-container>
                </div>
              </ng-container>
            </div>
          </mat-expansion-panel>
        </ng-container>

        <!-- CO2 Emissions -->
        <ng-container
          *ngIf="calculationResultFacade.isEmissionResultAvailable$ | ngrxPush"
        >
          <mat-expansion-panel
            id="emission"
            *transloco="let t; read: 'calculationResultReport.co2Emissions'"
            class="border-border w-full border !shadow-none mb-4"
            [expanded]="
              (selctedCalculationTypes$ | ngrxPush)?.emission?.selected === true
            "
          >
            <mat-expansion-panel-header class="h-[64px]">
              <mat-panel-title>
                <div class="flex flex-row">
                  <div class="my-auto">
                    <mat-icon color="primary" svgIcon="co2"></mat-icon>
                  </div>
                  <div class="my-auto ml-2">
                    {{ t('title') }}
                  </div>
                </div>
              </mat-panel-title>
            </mat-expansion-panel-header>

            <div
              class="full-w full-h !-mx-6 !-mb-4"
              *ngIf="
                calculationResultFacade.calculationReportCO2Emission$
                  | ngrxPush as co2Emissions
              "
            >
              <div
                class="text-body-2 border-border flex w-full flex-col md:flex-row border-t"
              >
                <!-- Chart -->
                <div
                  class="border-border flex flex-shrink-0 flex-col items-center border-r p-2 md:p-8"
                >
                  <div class="text-high-emphasis mb-2">
                    {{ t('chartTitle') }}
                  </div>
                  <div
                    *ngIf="co2EmissionOptions$ | async as co2EmissionOptions"
                    echarts
                    class="h-[200px] w-[200px]"
                    [options]="co2EmissionOptions"
                    [initOpts]="{
                      width: 200,
                      height: 200
                    }"
                  ></div>

                  <div class="text-medium-emphasis mh-2">
                    {{ t('chartDesc') }}
                  </div>
                </div>
                <div class="flex flex-grow flex-col">
                  <!-- Upstream -->
                  <div
                    class="border-border w-full border-t md:border-t-0 border-b px-4 md:px-8 py-4"
                  >
                    <div
                      class="text-high-emphasis flex flex-row items-center pb-4"
                    >
                      <ea-tag
                        value=""
                        styleClass="bg-[#DDE86E]"
                        class="mr-2"
                      ></ea-tag>

                      {{ t('upstreamTitle') }}
                    </div>
                    <div
                      class="flex w-full flex-row md:justify-start items-center justify-center"
                    >
                      <div
                        class="flex flex-row items-end justify-center py-2 pr-4"
                      >
                        <div class="text-h6 text-high-emphasis">
                          {{
                            (co2Emissions?.co2_upstream | meaningfulRound) ||
                              '-'
                          }}
                        </div>
                        <div class="text-body-2 text-high-emphasis pl-1">
                          kg
                        </div>
                      </div>
                      <mat-divider [vertical]="true"></mat-divider>
                      <div
                        class="flex flex-row items-end justify-center py-2 pl-4"
                      >
                        <div class="text-h6 text-high-emphasis">
                          {{
                            (co2Emissions?.co2_upstream_percent * 100
                              | number: '1.1-1') || '-'
                          }}
                        </div>
                        <div class="text-body-2 text-high-emphasis pl-1">%</div>
                      </div>
                    </div>
                    <div class="text-medium-emphasis pt-4">
                      {{ t('upstreamHint') }} -
                      <a
                        class="text-primary"
                        [href]="t('upstreamHintLink')"
                        target="_blank"
                        >{{ t('upstreamHintLinkText') }}</a
                      >
                    </div>
                  </div>

                  <!-- Downstream -->
                  <div class="w-full px-4 md:px-8 py-4">
                    <div
                      class="text-high-emphasis flex flex-row items-center pb-4"
                    >
                      <ea-tag
                        value=""
                        styleClass="bg-[#7DC882]"
                        class="mr-2"
                      ></ea-tag>
                      {{ t('downstreamTitle') }}
                    </div>
                    <div
                      class="flex w-full flex-row md:justify-start justify-center items-center"
                    >
                      <div
                        class="flex flex-row items-end justify-center py-2 pr-4"
                      >
                        <div class="text-h6 text-high-emphasis">
                          {{
                            (co2Emissions?.co2_downstream | meaningfulRound) ||
                              '-'
                          }}
                        </div>
                        <div class="text-body-2 text-high-emphasis pl-1">
                          kg
                        </div>
                      </div>
                      <mat-divider [vertical]="true"></mat-divider>
                      <div
                        class="flex flex-row items-end justify-center py-2 pl-4"
                      >
                        <div class="text-h6 text-high-emphasis">
                          {{
                            (co2Emissions?.co2_downstream_percent * 100
                              | number: '1.1-1') || '-'
                          }}
                        </div>
                        <div class="text-body-2 text-high-emphasis pl-1">%</div>
                      </div>
                    </div>
                    <div class="text-medium-emphasis pt-4"></div>
                  </div>
                </div>
              </div>
              <div
                class="border-border flex flex-row items-center border-t px-4 py-2"
              >
                <div class="mr-2 flex-shrink-0">
                  <mat-icon color="primary">info_outline</mat-icon>
                </div>
                <div class="text-body-2 text-medium-emphasis">
                  {{ t('calculationHint') }} -
                  <a
                    class="text-primary"
                    [href]="t('calculationHintLink')"
                    target="_blank"
                    >{{ t('calculationHintLinkText') }}</a
                  >
                </div>
              </div>
            </div>
          </mat-expansion-panel>
        </ng-container>
      </div>

      <!-- Right Hand Navigation -->
      <div
        class="text-medium-emphasis ml-8 md:flex md:w-[250px] h-full mb-auto flex-row hidden"
        *transloco="let t; read: 'calculationSelection'"
      >
        <mat-divider [vertical]="true"></mat-divider>
        <div class="my-2 ml-8 mr-4 w-full">
          <div class="mb-2">
            <div class="flex items-center justify-center">
              <mat-icon class="mr-2 flex-shrink-0">calculate</mat-icon>
              <div>{{ t('calculations') }}</div>
            </div>
          </div>
          <mat-divider></mat-divider>
          <div
            class="flex pt-4 flex-col"
            *ngIf="
              calculationResultFacade.getSelectedCalculations$
                | ngrxPush as getSelectedCalculations
            "
          >
            <div
              *ngFor="let config of getSelectedCalculations"
              (click)="scrollIntoView(config.name)"
              class="hover:bg-secondary-100 hover:text-primary mt-4 flex w-full flex-row items-center px-4 py-2 hover:rounded cursor-pointer"
            >
              <mat-icon class="mr-2 flex-shrink-0" [svgIcon]="config.svgIcon">{{
                config.icon
              }}</mat-icon>
              <div class="text-subtitle-2 whitespace-normal">
                {{ t(config.label) }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </mat-dialog-content>
</ng-container>

<ng-template #loadingTemplate>
  <div class="item-center flex content-center p-8">
    <div class="ml-auto mr-auto">
      <mat-spinner diameter="20"></mat-spinner>
    </div>
  </div>
</ng-template>
