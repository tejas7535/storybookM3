<ng-container
  *transloco="
    let t;
    read: 'processCaseView.tabs.overview.approvalCockpit.workflow'
  "
>
  <ng-container *ngrxLet="workflowEvents">
    <!--auto approved event does not show a title for the Iterations-->
    <ng-container *ngIf="!autoApprovedEvent">
      <!--check which title to display find the template-->
      <ng-container
        *ngIf="
          rejectedEvent || cancelledEvent;
          then aborted;
          else inApprovalOrApproved
        "
      ></ng-container>
    </ng-container>

    <!-- all Events in chronological order -->
    <!-- if no items for iterations, do not show IterationsSection but display a timeline line -->
    <div
      *ngIf="workflowEvents.length < 1"
      class="timeline noIterations border-l-2 border-l-border border-dashed h-[1.5rem] bg border-y-border ml-3"
    ></div>
    <!-- show Iterations Section-->
    <div
      *ngIf="workflowEvents.length >= 1"
      class="timeline iterations border-l-2 ml-3"
      [ngClass]="[
        inApproval ? 'border-dashed border-l-border' : 'border-solid',
        rejectedEvent || cancelledEvent ? 'text-error' : '',
        isApproved ? 'text-approval-status-green' : ''
      ]"
    >
      <gq-approval-workflow-history-section
        *ngIf="!iterationVisible"
        class="cursor-pointer"
        [icon]="'add'"
        [iconColor]="'text-low-emphasis'"
        [title]="t('viewIterationsLabel', { amount: workflowEvents.length })"
        [isIterationItem]="true"
        (click)="toggleIteration()"
      >
      </gq-approval-workflow-history-section>

      <ng-container *ngIf="iterationVisible">
        <!-- we want the events asc for the iterations-->
        <ng-container *ngFor="let event of workflowEvents?.slice().reverse()">
          <gq-approval-workflow-history-section
            [title]="t(event.event)"
            [subtitle]="
              t('eventCreatedBy', {
                date: event.eventDate | translocoDate: translocoDatePipeConfig,
                user: event.user | approverDisplay: t('unknownApprover')
              })
            "
            [comment]="event.comment"
            [isIterationItem]="true"
            [iterationItemIconColor]="iconColor"
          >
          </gq-approval-workflow-history-section>
        </ng-container>
      </ng-container>

      <gq-approval-workflow-history-section
        *ngIf="iterationVisible"
        class="cursor-pointer"
        [icon]="'remove'"
        [iconColor]="'text-low-emphasis'"
        [title]="t('hideIterationsLabel', { amount: workflowEvents.length })"
        [isIterationItem]="true"
        (click)="toggleIteration()"
      >
      </gq-approval-workflow-history-section>
    </div>
    <!--###############                 TEMPLATES for Title of Iterations             #################-->
    <!--###############  !!! Iterations Title does NOT display the events comment !!! #################-->
    <ng-template #inApprovalOrApproved>
      <gq-approval-workflow-history-section
        *ngIf="inApproval"
        [icon]="'autorenew'"
        [iconColor]="'text-in-progress-blue'"
        [title]="t('inApprovalLabel')"
        [subtitle]="
          t('approversApproved', {
            variable: receivedApprovalsOfRequiredApprovals
          })
        "
      >
      </gq-approval-workflow-history-section>

      <gq-approval-workflow-history-section
        *ngIf="isApproved"
        [icon]="'check_circle_outline'"
        [iconColor]="'text-link'"
        [title]="t('inApprovalLabel')"
        [subtitle]="
          t('approversApproved', {
            variable: receivedApprovalsOfRequiredApprovals
          })
        "
      >
      </gq-approval-workflow-history-section>
    </ng-template>

    <ng-template #aborted>
      <gq-approval-workflow-history-section
        *ngIf="cancelledEvent"
        [icon]="'remove_circle'"
        [iconColor]="'text-error'"
        [title]="t('cancelledLabel')"
        [titleTextColor]="'text-error'"
        [subtitle]="
          t('eventCreatedBy', {
            date:
              cancelledEvent.eventDate | translocoDate: translocoDatePipeConfig,
            user: cancelledEvent.user | approverDisplay: t('unknownApprover')
          })
        "
      >
      </gq-approval-workflow-history-section>
      <gq-approval-workflow-history-section
        *ngIf="rejectedEvent"
        [icon]="'warning'"
        [iconColor]="'text-error'"
        [title]="t('rejectedLabel')"
        [titleTextColor]="'text-error'"
        class="text-error"
        [subtitle]="
          t('eventCreatedBy', {
            date:
              rejectedEvent.eventDate | translocoDate: translocoDatePipeConfig,
            user: rejectedEvent.user | approverDisplay: t('unknownApprover')
          })
        "
      >
      </gq-approval-workflow-history-section>
    </ng-template>
  </ng-container>
</ng-container>
