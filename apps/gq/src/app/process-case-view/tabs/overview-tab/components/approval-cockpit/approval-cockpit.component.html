<mat-card
  appearance="outlined"
  class="mat-elevation-z0 !bg-transparent border-border w-full grow rounded border-[1px]"
  *transloco="let t; read: 'processCaseView.tabs.overview.approvalCockpit'"
>
  <mat-card-content>
    <div class="flex flex-col">
      <div class="mat-card-title text-on-surface gq-text-5 pb-5 !mb-[4px]">
        {{ t('approvalOverview') }}
      </div>
      <gq-approval-workflow-history
        class="pb-6"
        [workflowEvents]="approvalFacade.getApprovalWorkflowEvents$ | ngrxPush"
        [quotationAutoApprovedEvent]="
          approvalFacade.quotationAutoApprovedEvent$ | ngrxPush
        "
        [quotationCancelledEvent]="
          approvalFacade.quotationCancelledEvent$ | ngrxPush
        "
        [quotationRejectedEvent]="
          approvalFacade.quotationRejectedEvent$ | ngrxPush
        "
        [quotationFinalReleaseEvent]="
          approvalFacade.quotationFinalReleaseEvent$ | ngrxPush
        "
        [receivedApprovalsOfRequiredApprovals]="
          approvalFacade.receivedApprovalsOfRequiredApprovals$ | ngrxPush
        "
        [quotationStatus]="approvalFacade.quotationStatus$ | ngrxPush"
      ></gq-approval-workflow-history>

      <div
        class="my-2 bg-gradient-to-r from-low-emphasis from-50% to-white to-0% bg-[length:16px] bg-repeat-x bg-top h-[1px]"
      ></div>

      @if (!(approvalFacade.quotationAutoApprovedEvent$ | ngrxPush)) {
        <div class="flex items-center justify-between">
          <div class="py-6 text-body-large font-bold">
            {{ t('approver') }}
          </div>
          <div>
            <div
              class="flex flex-row items-center rounded-full px-2 py-1"
              [ngClass]="
                (approvalFacade.quotationFullyApproved$ | ngrxPush)
                  ? 'bg-success-container'
                  : 'bg-surface-container'
              "
            >
              <mat-icon
                class="!flex items-center !text-[14px] font-normal"
                [ngClass]="
                  (approvalFacade.quotationFullyApproved$ | ngrxPush)
                    ? 'text-success'
                    : 'text-on-surface'
                "
                >check_circle_outline</mat-icon
              >
              <span
                class="text-[10px]"
                [ngClass]="
                  (approvalFacade.quotationFullyApproved$ | ngrxPush)
                    ? 'text-success'
                    : 'text-on-surface'
                "
                >{{
                  approvalFacade.receivedApprovalsOfRequiredApprovals$
                    | ngrxPush
                }}</span
              >
            </div>
          </div>
        </div>
        @for (
          approvalStatus of approvalFacade.approvalStatusOfRequestedApprover$
            | ngrxPush;
          track i;
          let i = $index;
          let length = $count
        ) {
          <gq-approval-workflow-approver
            [approver]="approvalStatus.approver"
            [workflowEvent]="approvalStatus.event"
            [quotationStatus]="approvalFacade.quotationStatus$ | ngrxPush"
            [workflowInProgress]="approvalFacade.workflowInProgress$ | ngrxPush"
          ></gq-approval-workflow-approver>
          @if (!(length - 1 === i)) {
            <gq-horizontal-divider></gq-horizontal-divider>
          }
        }
      } @else {
        <div class="flex items-center justify-between">
          <div class="py-4 !text-body-large !font-bold">
            {{ t('approver') }}
          </div>
          <div>
            <div
              class="flex flex-row bg-success-container items-center rounded-full px-2 py-1"
            >
              <mat-icon
                class="text-success !flex items-center !text-[14px] font-normal"
                >check_circle_outline</mat-icon
              >
              <span class="text-[12px] text-success">1/1</span>
            </div>
          </div>
        </div>
        <gq-approval-workflow-approver
          [approver]="
            (approvalFacade.quotationAutoApprovedEvent$ | ngrxPush)?.user
          "
          [workflowEvent]="
            approvalFacade.quotationAutoApprovedEvent$ | ngrxPush
          "
          [workflowInProgress]="false"
        ></gq-approval-workflow-approver>
      }
      <!--template when quotation has been automatically approved-->

      @if (approvalFacade.shouldShowApprovalButtons$ | ngrxPush) {
        <gq-horizontal-divider class="mx-[-1rem] mt-4"></gq-horizontal-divider>
        <div class="flex flex-row justify-between">
          <button
            mat-button
            [disableRipple]="true"
            (click)="openRejectionDialog()"
            class="noRippleHover warning-with-opacity"
          >
            <mat-icon class="text-icon-warning">clear</mat-icon>
            <span class="text-warning text-[12px]">{{
              t('rejectButton')
            }}</span>
          </button>
          <button
            mat-button
            [disableRipple]="true"
            (click)="openForwardDialog()"
            class="noRippleHover neutral-with-opacity"
          >
            <mat-icon class="text-on-surface-variant">arrow_forward</mat-icon>
            <span class="text-on-surface-variant text-[12px]">{{
              t('forwardButton')
            }}</span>
          </button>
          <button
            mat-button
            [disableRipple]="true"
            (click)="openApprovalDialog()"
          >
            <mat-icon class="text-icon-success">check</mat-icon
            ><span class="text-success text-[12px]">{{
              t('approveButton')
            }}</span>
          </button>
        </div>
      }
    </div>
  </mat-card-content>
</mat-card>
