<div
  class="flex flex-col"
  *transloco="
    let t;
    read: 'processCaseView.tabs.overview.approvalCockpit.workflow'
  "
>
  <!-- the Headline-->
  <div class="flex items-center justify-between pb-6">
    <div class="text-body-1 font-bold">{{ t('historyLabel') }}</div>
  </div>

  <!--StartEvent-->
  <gq-approval-workflow-history-section
    [icon]="'check_circle_outline'"
    [iconColor]="'text-link'"
    [title]="
      startedEvent?.event === eventType.AUTO_APPROVAL
        ? t('workflowAutoApprovedText')
        : t('workflowStartedText')
    "
    [subtitle]="
      t('eventCreatedBy', {
        date: startedEvent?.eventDate | translocoDate: translocoDatePipeConfig,
        user: startedEvent?.user | approverDisplay: t('unknownApprover')
      })
    "
  ></gq-approval-workflow-history-section>
  <!--timeline under start event-->
  <!--
    an auto_approved quotation has for a short period of time just the GQ generated autoApproved event. A little later the Released events is received and displayed. 
    we display the short form for auto-approval, when we have  a) only the auto_approved event and b) only the auto_approved and released event
    when an auto_approved quotation has been cancelled and auto-approved again, we will display the iterations section
    -->
  <ng-container
    *ngIf="!(quotationAutoApprovedEvent && workflowEvents?.length <= 2)"
  >
    <div
      class="timeline history border-l-2 border-solid h-[1.5rem] bg border-y-border ml-3"
      [ngClass]="
        quotationStatus === quotationStatusEnum.APPROVED
          ? 'text-approval-status-green'
          : 'border-l-border'
      "
    ></div>

    <!-- section of all Iterations Event-->
    <gq-approval-workflow-history-iterations
      [autoApprovedEvent]="quotationAutoApprovedEvent"
      [cancelledEvent]="quotationCancelledEvent"
      [rejectedEvent]="quotationRejectedEvent"
      [workflowEvents]="filteredWorkflowEvents"
      [isApproved]="quotationStatus === quotationStatusEnum.APPROVED"
      [inApproval]="quotationStatus === quotationStatusEnum.IN_APPROVAL"
      [receivedApprovalsOfRequiredApprovals]="
        receivedApprovalsOfRequiredApprovals
      "
    ></gq-approval-workflow-history-iterations>
  </ng-container>
  <!--EndEvent-->
  <ng-container
    *ngIf="
      quotationStatus === quotationStatusEnum.APPROVED;
      then approvalComplete;
      else approvalPending
    "
  >
  </ng-container>

  <ng-template #approvalComplete>
    <ng-container
      *ngIf="
        quotationAutoApprovedEvent;
        then quotationAutoApproved;
        else quotationByWorkflowApproved
      "
    ></ng-container>
  </ng-template>

  <ng-template #quotationAutoApproved>
    <!-- when quotation was auto_approved (two events received:Auto_Approved and Released) and never touched again, we just display the start Event,
        when workflowEvents.length <2 we have iterations such as cancelled and then restarted 
      -->
    <gq-approval-workflow-history-section
      *ngIf="workflowEvents?.length > 2"
      [icon]="'check_circle_outline'"
      [iconColor]="'text-link'"
      [title]="t('workflowAutoApprovedText')"
      [subtitle]="
        quotationAutoApprovedEvent?.eventDate
          | translocoDate: translocoDatePipeConfig
      "
    ></gq-approval-workflow-history-section
  ></ng-template>
  <ng-template #quotationByWorkflowApproved>
    <gq-approval-workflow-history-section
      [icon]="'check_circle_outline'"
      [iconColor]="'text-link'"
      [title]="t('quotationApprovedText')"
      [subtitle]="
        quotationFinalReleaseEvent?.eventDate
          | translocoDate: translocoDatePipeConfig
      "
    ></gq-approval-workflow-history-section
  ></ng-template>

  <ng-template #approvalPending>
    <!-- when quotation has been rejected, we do not want the end event to be displayed-->
    <ng-container *ngIf="!quotationRejectedEvent">
      <gq-approval-workflow-history-section
        [icon]="'timer_outline'"
        [iconColor]="'text-low-emphasis'"
        [title]="t('caseApprovalStatus')"
        [subtitle]="t('approvalPending')"
      ></gq-approval-workflow-history-section>
    </ng-container>
  </ng-template>
</div>
