<ng-container
  *transloco="
    let t;
    scope: 'f-pricing';
    read: 'fPricing.pricingAssistantModal.comparisonPanel'
  "
>
  <div class="h-full pb-6">
    <button mat-button (click)="closeView.emit()" class="flex items-center">
      <mat-icon class="text-on-surface">keyboard_arrow_left</mat-icon>
      {{ t('backButton') }}
    </button>

    <div class="h-full flex flex-col pb-6">
      <div class="flex items-center pb-4">
        <div class="w-1/5"></div>
        <div class="gq-text-5" [ngClass]="showDelta ? '!w-[30%]' : '!w-2/5'">
          <span class="text-on-surface pl-4">
            {{ referenceMaterial.materialDescription }}
          </span>
        </div>
        <div class="!w-[30%]">
          <span class="gq-text-5 text-on-surface pl-4">
            {{ comparedMaterial.description }}
          </span>
        </div>
        <div class="flex-1">
          <button mat-button (click)="toggleIconVisibility()">
            <mat-icon class="icon-5 text-on-surface">
              {{ showDelta ? 'visibility_off' : 'visibility' }}
            </mat-icon>
            {{ showDelta ? t('hideDelta') : t('showDelta') }}
          </button>
        </div>
      </div>

      @if (materialComparisonLoading) {
        <ng-template [ngTemplateOutlet]="loadingSpinner"></ng-template>
      } @else {
        <div class="overflow-y-auto h-full flex flex-col">
          @for (materialInfo of materialInformation; track materialInfo) {
            <div class="flex [&:not(:last-child)]:pb-4 items-end">
              <gq-comparison-panel
                [ngClass]="showDelta ? 'w-4/5' : 'flex-1'"
                [panelKey]="materialInfo.informationKey"
                [data]="materialInfo.properties"
                [numberOfDeltas]="materialInfo.countOfDelta"
                [showDelta]="showDelta"
                (togglePanelExpanded)="
                  onTogglePanelExpanded(materialInfo.informationKey, $event)
                "
              ></gq-comparison-panel>
              @if (
                showDelta &&
                materialInfo.countOfDelta > 0 &&
                showDeltasByKey.get(materialInfo.informationKey)
              ) {
                <gq-comparison-delta
                  class="w-1/5"
                  [propertyDeltas]="materialInfo.deltaValues"
                >
                </gq-comparison-delta>
              }
            </div>
          }
        </div>
      }
    </div>
  </div>
</ng-container>

<ng-template #loadingSpinner>
  <schaeffler-loading-spinner></schaeffler-loading-spinner>
</ng-template>
