<div
  class="flex h-full flex-col"
  *transloco="let t; read: 'shared.editingModal'"
>
  @if (isDialog) {
    <gq-dialog-header
      class="mb-4"
      [title]="
        t('title', {
          id: modalData?.quotationDetail?.quotationItemId,
          fieldName: t(modalData.field),
        })
      "
      (closeDialog)="closeDialog()"
    >
    </gq-dialog-header>
  }

  @if ((updateLoading$ | ngrxPush) === false) {
    <form [formGroup]="editingFormGroup" class="flex h-full flex-col">
      @if (isPriceChangeTypeAvailable) {
        <mat-radio-group
          class="flex flex-col pb-4"
          [formControlName]="IS_RELATIVE_PRICE_CONTROL_NAME"
        >
          <mat-radio-button
            [value]="false"
            [disabled]="isDisabled"
            (change)="callPriceChangeTypeSwitchHandler(false)"
            [attr.data-cy]="modalData.field + '-modal_absolute-radio-btn'"
          >
            <span class="pl-2 text-on-surface text-body-large">
              {{ t('absolute') }}
            </span>
          </mat-radio-button>
          <mat-radio-button
            [value]="true"
            (change)="callPriceChangeTypeSwitchHandler(true)"
            [disabled]="isRelativePriceChangeDisabled || isDisabled"
            [attr.data-cy]="modalData.field + '-modal_relative-radio-btn'"
          >
            <span class="pl-2 text-on-surface text-body-large">
              {{ t('relative') }}
            </span>
          </mat-radio-button>
        </mat-radio-group>
      }
      <div class="flex h-full flex-row mt-4">
        <mat-form-field class="w-full" appearance="outline">
          <mat-label>{{
            t(
              'labels.' +
                modalData.field +
                (editingFormGroup.get(IS_RELATIVE_PRICE_CONTROL_NAME)?.value ||
                !isPriceChangeTypeAvailable
                  ? ''
                  : 'Absolute')
            )
          }}</mat-label>
          <input
            class="text-label-small !leading-7"
            formControlName="valueInput"
            (keydown)="callInputFieldKeyDownHandler($event)"
            [placeholder]="localeValue"
            type="text"
            autocomplete="off"
            cdkTextareaAutosize
            [step]="incrementStep ?? 1"
            matInput
            [attr.data-cy]="modalData.field + '-modal_value-input'"
            #editInputField
          />
          @if (showFieldHint) {
            <mat-hint>{{
              t('hints.fieldHint', {
                field: modalData.field,
                param1: hintMsgParams1,
                param2: hintMsgParams2,
              })
            }}</mat-hint>
          }
          <mat-error>{{
            t('errors.invalidInput', {
              field: modalData.field,
              param1: errorMsgParams1,
              param2: errorMsgParams2,
            })
          }}</mat-error>
        </mat-form-field>
        <div class="ml-4 mt-3 flex flex-col gap-2">
          <mat-icon
            class="text-on-surface-variant"
            [ngClass]="
              isDisabled
                ? 'pointer-events-none cursor-default'
                : 'cursor-pointer'
            "
            (click)="changeValueIncrementally(incrementStep ?? 1)"
            >add
          </mat-icon>
          <mat-icon
            class="text-on-surface-variant"
            [ngClass]="
              isDisabled
                ? 'pointer-events-none cursor-default'
                : 'cursor-pointer'
            "
            (click)="changeValueIncrementally(decrementStep ?? -1)"
            >remove</mat-icon
          >
        </div>
      </div>
      <!-- 
        container to show additional content provided and handled by a child component
        the FormControl of the additional content is passed to the child component
      -->

      <ng-container
        *ngTemplateOutlet="
          additionalContentTemplate;
          context: {
            formControl: editingFormGroup.get(ADDITIONAL_CONTENT_CONTROL_NAME),
          }
        "
      ></ng-container>

      @if (warningText) {
        <div class="mt-2">
          <gq-info-banner [infoText]="warningText" [isWarning]="true">
          </gq-info-banner>
        </div>
      }
      @if (affectedKpis?.length > 0) {
        <gq-kpi-list
          [editingModalData]="modalData"
          [kpis]="affectedKpis"
        ></gq-kpi-list>
      }
      <!-- 
        container to show additional kpi content provided and handled by a child component.
        The FormControl of the additional content and the quotationDetail object is passed to the child component
      -->

      <ng-container
        *ngTemplateOutlet="
          kpiAdditionalContentTemplate;
          context: {
            quotationDetail: modalData.quotationDetail,
            formControl: editingFormGroup.get(ADDITIONAL_CONTENT_CONTROL_NAME),
          }
        "
      ></ng-container>

      <ng-container
        *ngTemplateOutlet="warningTemplate || defaultTemplate"
      ></ng-container>
      <ng-template #defaultTemplate>
        <gq-info-banner [infoText]="t('warning')"> </gq-info-banner>
      </ng-template>
      @if (isDialog) {
        <div class="pt-8 flex justify-end gap-4">
          <button
            mat-button
            (click)="closeDialog()"
            [attr.data-cy]="modalData.field + '-modal_cancel-btn'"
          >
            <span> {{ t('cancel') }} </span>
          </button>
          <button
            mat-flat-button
            [disabled]="editingFormGroup.invalid || !hasValueChanged"
            (click)="confirmEditing()"
            [attr.data-cy]="modalData.field + '-modal_submit-btn'"
          >
            <span> {{ t('confirm.' + modalData.field) }} </span>
          </button>
        </div>
      }
    </form>
  } @else {
    <div class="py-24">
      <schaeffler-loading-spinner
        class="h-full"
        [relative]="true"
      ></schaeffler-loading-spinner>
    </div>
  }
</div>
