<mat-form-field [appearance]="appearance" class="w-full">
  <mat-label *ngIf="label">{{ label }}</mat-label>
  <input
    type="text"
    [matAutocomplete]="auto"
    matInput
    [formControl]="searchControl"
    [class.text-high-emphasis]="!control.value"
    [class.text-link]="control.value"
    (blur)="onTouched()"
    [placeholder]="placeholder"
  />
  <mat-autocomplete
    #auto="matAutocomplete"
    [displayWith]="displayWithFn"
    [autoActiveFirstOption]="true"
    (optionSelected)="onOptionSelected($event.option.value)"
  >
    <div>
      <ng-content
        select="[loadingContent]"
        *ngIf="loading; else searchOptionsTemplate"
      ></ng-content>
      <ng-template #searchOptionsTemplate>
        <div
          *ngIf="stringOptions?.length === 0 && noResultsText"
          class="flex h-12 w-full flex-col content-around"
        >
          <div class="relative my-auto text-center text-high-emphasis">
            {{ noResultsText }}
          </div>
        </div>
        <ng-content select="[errorContent]" *ngIf="error"></ng-content>
        <div *ngIf="!loading && !error">
          <mat-option
            *ngFor="let option of filteredOptions; trackBy: trackByFn"
            [value]="option"
            [innerHTML]="option.title"
            [disabled]="option.disabled"
            class="!h-10 !text-caption"
          ></mat-option>
        </div>
      </ng-template>
      <mat-option #dummyOption class="!h-0"></mat-option>
    </div>
  </mat-autocomplete>
  <div matSuffix>
    <mat-icon *ngIf="!searchControl.value; else clearButtonTemplate"
      >search</mat-icon
    >
    <ng-template #clearButtonTemplate>
      <button mat-icon-button (click)="onSearchReset()">
        <mat-icon>clear</mat-icon>
      </button>
    </ng-template>
  </div>

  <mat-error>
    <ng-content select="[matErrorContent]"></ng-content>
  </mat-error>
</mat-form-field>
