<mat-form-field floatLabel="never" class="max-w-full">
  <mat-label class="ml-2 divide-veryLight">{{ label }}</mat-label>
  <input
    type="text"
    [matAutocomplete]="auto"
    matInput
    [formControl]="control"
    class="autocomplete-input text-high-emphasis ml-2"
    [class.text-high-emphasis]="(valueSelected$ | ngrxPush) === false"
    [class.text-link]="valueSelected$ | ngrxPush"
    (blur)="onTouched()"
  />
  <mat-autocomplete
    #auto="matAutocomplete"
    [displayWith]="optionTitle"
    (optionSelected)="setValue($event)"
  >
    <div [hidden]="(showOptions$ | ngrxPush) === false">
      <mat-option
        *ngIf="loading"
        class="h-20 flex items-center justify-center loading-option pointer-events-none"
      >
        <mat-spinner diameter="20"></mat-spinner>
        <span class="ml-4">{{ loadingMessage }}</span>
      </mat-option>
      <mat-option
        *ngIf="noResults(filteredOptions$ | async)"
        class="h-20 flex items-center justify-center pointer-events-none"
        >{{ noResultsText }}</mat-option
      >
      <mat-option
        *ngIf="error"
        class="h-20 flex items-center justify-center pointer-events-none"
      >
        <mat-icon class="text-error icon">cancel</mat-icon>
        <span>Error. Please try again</span>
      </mat-option>
      <div [hidden]="loading && !error">
        <mat-option
          *ngFor="let option of filteredOptions$ | ngrxPush; trackBy: trackByFn"
          [value]="option"
        >
          {{ option.title }}
        </mat-option>
      </div>
    </div>
  </mat-autocomplete>
  <div
    class="autocomplete-icon h-full absolute right-3 top-4 flex items-center flex-col"
    [class.clear-icon]="searchStringDeletable"
    [class.search-icon]="!searchStringDeletable"
  >
    <mat-icon class="icon search">search</mat-icon>
    <mat-icon class="icon clear cursor-pointer" (click)="clearSearchString()"
      >clear</mat-icon
    >
  </div>
</mat-form-field>
